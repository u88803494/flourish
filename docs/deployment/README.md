# Flourish éƒ¨ç½²æ–‡æª”

**æœ€å¾Œæ›´æ–°**ï¼š2025-11-07
**ç•¶å‰æ¶æ§‹**ï¼šSupabase + Vercel

---

## ğŸ“‹ æ¶æ§‹æ¦‚è¦½

### ç•¶å‰æ¶æ§‹ï¼ˆ2025-11-07 èµ·ï¼‰

```
Frontend (Flow/Apex) â†’ Supabase (Database + Auth + REST API)
         â†“
     Vercel
```

**æŠ€è¡“æ£§**ï¼š

- **å‰ç«¯**ï¼šNext.js (Flow + Apex)
- **å‰ç«¯è¨—ç®¡**ï¼šVercel
- **å¾Œç«¯æœå‹™**ï¼šSupabaseï¼ˆPostgreSQL + Auth + è‡ªå‹•ç”Ÿæˆ REST APIï¼‰
- **æˆæœ¬**ï¼š$0/æœˆï¼ˆå®Œå…¨å…è²»ï¼‰

### æ¶æ§‹æ±ºç­–

ç¶“éå®Œæ•´çš„æŠ€è¡“è©•ä¼°å’Œéƒ¨ç½²æ¸¬è©¦ï¼ˆSprint 8ï¼‰ï¼Œæˆ‘å€‘æ±ºå®šæ¡ç”¨ç´” Supabase æ¶æ§‹ã€‚

**æ±ºç­–æ–‡æª”**ï¼š

- ğŸ“„ [ADR 001 - Architecture Simplification](../decisions/001-architecture-simplification.md)
- ğŸ“„ [Sprint 8 Deployment Evaluation](../sprints/sprint-0-foundation/08-deployment-evaluation.md)

**ä¸»è¦åŸå› **ï¼š

- âœ… ç¯€çœ 100% éƒ¨ç½²æˆæœ¬ï¼ˆ$0 vs $7+/æœˆï¼‰
- âœ… æ¸›å°‘ 70% ç¶­è­·å·¥ä½œé‡
- âœ… åŠ é€Ÿ 60% é–‹ç™¼æ™‚é–“
- âœ… å®Œç¾é©åˆ Flourish æ ¸å¿ƒéœ€æ±‚ï¼ˆè¨˜å¸³ + çµ±è¨ˆ + å±•ç¤ºï¼‰

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å‰ç«¯éƒ¨ç½²ï¼ˆVercelï¼‰

**Flow App** - è¨˜å¸³å‰ç«¯

- **URL**: https://flourish-flow.vercel.app
- **Port (é–‹ç™¼)**ï¼š3100
- **æ¡†æ¶**ï¼šNext.js 14

**Apex App** - çµ±è¨ˆå‰ç«¯

- **URL**: https://flourish-apex.vercel.app
- **Port (é–‹ç™¼)**ï¼š3200
- **æ¡†æ¶**ï¼šNext.js 14

#### ç’°å¢ƒè®Šæ•¸é…ç½®

åœ¨ Vercel Dashboard â†’ Settings â†’ Environment Variables è¨­å®šï¼š

```bash
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=<your-supabase-project-url>
NEXT_PUBLIC_SUPABASE_ANON_KEY=<your-supabase-anon-key>

# Optional: Analytics
NEXT_PUBLIC_VERCEL_ANALYTICS_ID=<auto-generated>
```

#### éƒ¨ç½²æµç¨‹

1. **æ¨é€åˆ° GitHub**ï¼š

   ```bash
   git push origin main
   ```

2. **è‡ªå‹•éƒ¨ç½²**ï¼šVercel è‡ªå‹•åµæ¸¬ä¸¦éƒ¨ç½²

3. **Preview Deployments**ï¼š
   - æ¯å€‹ PR è‡ªå‹•ç”Ÿæˆ preview URL
   - æ ¼å¼ï¼š`https://flourish-flow-<hash>.vercel.app`

### å¾Œç«¯æœå‹™ï¼ˆSupabaseï¼‰

**Supabase Project**:

- **URL**: https://fstcioczrehqtcbdzuij.supabase.co
- **Region**: ap-northeast-1 (Tokyo)
- **Plan**: Free Tier

#### Supabase è¨­ç½®

**Database**:

- PostgreSQL è³‡æ–™åº«
- 500MB å„²å­˜ï¼ˆFree tierï¼‰
- è‡ªå‹•å‚™ä»½

**Authentication**:

- Email/Password ç™»å…¥
- Social OAuthï¼ˆå¯é¸ï¼‰
- JWT tokens

**REST API**:

- è‡ªå‹•ç”Ÿæˆçš„ RESTful API
- åŸºæ–¼ PostgreSQL schema
- Row Level Security (RLS) ä¿è­·

**è©³ç´°è¨­ç½®è«‹åƒè€ƒ**ï¼š

- [Supabase Setup Guide](./supabase-setup.md)ï¼ˆå¾…å»ºç«‹ï¼ŒSprint 9ï¼‰

---

## ğŸ”’ å®‰å…¨æ€§

### Row Level Security (RLS)

Supabase ä½¿ç”¨ Row Level Security policies ä¿è­·æ•¸æ“šï¼š

```sql
-- ç¯„ä¾‹ï¼šç”¨æˆ¶åªèƒ½å­˜å–è‡ªå·±çš„è¨˜å¸³è¨˜éŒ„
CREATE POLICY "Users can only access their own transactions"
  ON transactions
  FOR ALL
  USING (auth.uid() = user_id);
```

### ç’°å¢ƒè®Šæ•¸ç®¡ç†

- âœ… ä½¿ç”¨ Vercel Environment Variablesï¼ˆåŠ å¯†ï¼‰
- âœ… æœ¬åœ°é–‹ç™¼ä½¿ç”¨ `.env.local`ï¼ˆå·²åŠ å…¥ `.gitignore`ï¼‰
- âŒ **æ°¸é ä¸è¦æäº¤** `.env` æª”æ¡ˆåˆ° Git

### API Keys

- **Anon Key**ï¼šå¯å…¬é–‹ï¼ˆå‰ç«¯ä½¿ç”¨ï¼‰
- **Service Role Key**ï¼š**çµ•å°æ©Ÿå¯†**ï¼ˆåƒ…å¾Œç«¯ä½¿ç”¨ï¼Œä¸æš´éœ²çµ¦å‰ç«¯ï¼‰

---

## ğŸ“Š ç›£æ§èˆ‡ç¶­è­·

### Vercel ç›£æ§

- **Analytics**ï¼šWeb Analytics å’Œ Speed Insights
- **Logs**ï¼šå³æ™‚éƒ¨ç½²å’Œå‡½æ•¸æ—¥èªŒ
- **Alerts**ï¼šéƒ¨ç½²å¤±æ•—é€šçŸ¥

### Supabase ç›£æ§

- **Dashboard**ï¼šè³‡æ–™åº«æ•ˆèƒ½ç›£æ§
- **Logs**ï¼šSQL æŸ¥è©¢æ—¥èªŒ
- **API Metrics**ï¼šè«‹æ±‚æ•¸é‡å’Œå»¶é²

---

## ğŸ”„ Git å·¥ä½œæµç¨‹

è«‹åƒè€ƒï¼š[Git Workflow](./git-workflow.md)

**ç°¡è¦æµç¨‹**ï¼š

```bash
# 1. å‰µå»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feat/new-feature

# 2. é–‹ç™¼å’Œæäº¤
git add .
git commit -m "feat: add new feature"

# 3. æ¨é€ä¸¦å‰µå»º PR
git push origin feat/new-feature

# 4. åœ¨ GitHub å‰µå»º Pull Request

# 5. Review å¾Œåˆä½µåˆ° main

# 6. Vercel è‡ªå‹•éƒ¨ç½²åˆ° production
```

---

## ğŸ“š å­˜æª”æ–‡æª”

### NestJS + Render éƒ¨ç½²æ–¹æ¡ˆï¼ˆå·²å­˜æª”ï¼‰

åœ¨ Sprint 8 æœŸé–“ï¼Œæˆ‘å€‘å®Œæ•´è©•ä¼°äº† NestJS + Render éƒ¨ç½²æ–¹æ¡ˆã€‚é›–ç„¶æœ€çµ‚æ±ºå®šæ¡ç”¨ Supabaseï¼Œä½†ä¿ç•™äº†æ‰€æœ‰è©•ä¼°æ–‡æª”ä¾›æœªä¾†åƒè€ƒã€‚

**å­˜æª”ä½ç½®**ï¼š[docs/archive/render-deployment/](../archive/render-deployment/)

**å­˜æª”å…§å®¹**ï¼š

- Render Staging è¨­ç½®æŒ‡å—
- Render Production è¨­ç½®æŒ‡å—
- Keep-Alive ç›£æ§è¨­å®š
- å¾Œç«¯è¨—ç®¡å¹³å°æ¯”è¼ƒ
- éƒ¨ç½²æ±ºç­–è¨˜éŒ„

**ç‚ºä½•ä¿ç•™**ï¼š

- å±•ç¤ºå®Œæ•´çš„æŠ€è¡“è©•ä¼°éç¨‹
- æœªä¾†å¦‚éœ€å›åˆ° NestJS å¯å¿«é€Ÿæ¢å¾©
- ä½œç‚ºæ±ºç­–æ­·å²è¨˜éŒ„

---

## ğŸ›£ï¸ æœªä¾†é·ç§»è·¯å¾‘

### æƒ…å¢ƒ 1ï¼šéœ€è¦å°‘æ•¸è¤‡é›œé‚è¼¯

**è§£æ±ºæ–¹æ¡ˆ**ï¼šSupabase Edge Functions

```typescript
// Supabase Edge Function ç¯„ä¾‹
export async function handler(req: Request) {
  // è¤‡é›œæ¥­å‹™é‚è¼¯
  // ç¬¬ä¸‰æ–¹ API èª¿ç”¨
  return new Response(JSON.stringify(result));
}
```

### æƒ…å¢ƒ 2ï¼šéœ€è¦å¤§é‡è¤‡é›œå¾Œç«¯è™•ç†

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå›åˆ° NestJS + Render

- å·²æœ‰å®Œæ•´éƒ¨ç½²æ–‡æª”ï¼ˆå­˜æª”ï¼‰
- å·²æœ‰è¨­ç½®ç¶“é©—
- å¯å¿«é€Ÿæ¢å¾©

### æƒ…å¢ƒ 3ï¼šæ··åˆæ¶æ§‹

**è§£æ±ºæ–¹æ¡ˆ**ï¼šSupabase + é¸æ“‡æ€§ API

```
å¤§éƒ¨åˆ†åŠŸèƒ½ â†’ Supabase ç›´é€£
è¤‡é›œåŠŸèƒ½ â†’ NestJS API
```

---

## ğŸ“– ç›¸é—œæ–‡æª”

### æ±ºç­–æ–‡æª”

- [ADR 001 - Architecture Simplification](../decisions/001-architecture-simplification.md) â­
- [Sprint 8 Deployment Evaluation](../sprints/sprint-0-foundation/08-deployment-evaluation.md)

### å­˜æª”æ–‡æª”

- [Render Deployment Archive](../archive/render-deployment/) - NestJS + Render éƒ¨ç½²æ–¹æ¡ˆ

### å·¥ä½œæµç¨‹

- [Git Workflow](./git-workflow.md)

### Sprint æ–‡æª”

- [Sprint 0 Overview](../sprints/sprint-0-foundation/overview.md)
- [Sprint 9 - Supabase Migration](../sprints/sprint-0-foundation/0.9-supabase-migration.md)ï¼ˆå¾…å»ºç«‹ï¼‰

---

## ğŸ†˜ ç–‘é›£æ’è§£

### Vercel éƒ¨ç½²å¤±æ•—

1. æª¢æŸ¥ Build Logs
2. ç¢ºèªç’°å¢ƒè®Šæ•¸æ­£ç¢ºè¨­å®š
3. æœ¬åœ°æ¸¬è©¦ `pnpm build` æ˜¯å¦æˆåŠŸ

### Supabase é€£ç·šå•é¡Œ

1. æª¢æŸ¥ç’°å¢ƒè®Šæ•¸ `NEXT_PUBLIC_SUPABASE_URL` å’Œ `NEXT_PUBLIC_SUPABASE_ANON_KEY`
2. ç¢ºèª Supabase project ç‹€æ…‹æ­£å¸¸
3. æª¢æŸ¥ RLS policies æ˜¯å¦é˜»æ“‹è«‹æ±‚

### CORS éŒ¯èª¤

Supabase é è¨­å…è¨±æ‰€æœ‰ä¾†æºï¼Œä½†å¦‚éœ€èª¿æ•´ï¼š

1. Supabase Dashboard â†’ API Settings
2. èª¿æ•´ CORS allowed origins

---

## ğŸ“ æ”¯æ´è³‡æº

### å®˜æ–¹æ–‡æª”

- [Vercel Documentation](https://vercel.com/docs)
- [Supabase Documentation](https://supabase.com/docs)
- [Next.js Documentation](https://nextjs.org/docs)

### ç¤¾ç¾¤

- [Supabase Discord](https://discord.supabase.com/)
- [Vercel Community](https://github.com/vercel/vercel/discussions)

---

**ç¶­è­·è€…**ï¼šHenry Lee
**æœ€å¾Œæ›´æ–°**ï¼š2025-11-07
**ç‹€æ…‹**ï¼šâœ… Phase 0 å®Œæˆï¼Œæº–å‚™é€²å…¥ Sprint 9ï¼ˆSupabase Migrationï¼‰
