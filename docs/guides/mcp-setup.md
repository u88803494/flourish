# MCP (Model Context Protocol) è¨­ç½®æŒ‡å—

**æœ€å¾Œæ›´æ–°**ï¼š2025-11-12
**ç‹€æ…‹**ï¼šâœ… å·²é©—è­‰å¯ç”¨

---

## ğŸ“– ç›®éŒ„

- [ä»€éº¼æ˜¯ MCP?](#ä»€éº¼æ˜¯-mcp)
- [ç‚ºä»€éº¼ä½¿ç”¨ MCP?](#ç‚ºä»€éº¼ä½¿ç”¨-mcp)
- [å‰ç½®è¦æ±‚](#å‰ç½®è¦æ±‚)
- [Step 1: ç²å– Supabase è¨ªå•ä»¤ç‰Œ](#step-1-ç²å–-supabase-è¨ªå•ä»¤ç‰Œ)
- [Step 2: é…ç½® Claude Code](#step-2-é…ç½®-claude-code)
- [Step 3: æ¸¬è©¦ MCP é€£æ¥](#step-3-æ¸¬è©¦-mcp-é€£æ¥)
- [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)
- [å®‰å…¨æ€§èªªæ˜](#å®‰å…¨æ€§èªªæ˜)
- [ç›¸é—œè³‡æº](#ç›¸é—œè³‡æº)

---

## ä»€éº¼æ˜¯ MCP?

**Model Context Protocol (MCP)** æ˜¯ä¸€å€‹é–‹æ”¾æ¨™æº–å”è­°ï¼Œå…è¨± Claude èˆ‡å¤–éƒ¨ç³»çµ±ï¼ˆå¦‚ Supabaseï¼‰é€²è¡Œäº’å‹•ã€‚

åœ¨ Flourish å°ˆæ¡ˆä¸­ï¼ŒMCP è®“ Claude Code èƒ½å¤ ç›´æ¥æŸ¥è©¢å’Œæ“ä½œ Supabase è³‡æ–™åº«ï¼Œç„¡éœ€æ‰‹å‹•ç·¨å¯« SQL æŸ¥è©¢ã€‚

### MCP çš„æ ¸å¿ƒåŠŸèƒ½

- **ç›´æ¥è³‡æ–™åº«è¨ªå•**ï¼šåˆ—å‡ºè¡¨ã€æŸ¥è©¢æ•¸æ“šã€åŸ·è¡Œé·ç§»
- **å¯¦æ™‚ç‹€æ…‹æª¢æŸ¥**ï¼šæŸ¥çœ‹ RLS ç­–ç•¥ã€ç´¢å¼•ã€ç´„æŸ
- **è‡ªå‹•åŒ–æ“ä½œ**ï¼šç”Ÿæˆé¡å‹ã€ç®¡ç† schema
- **é–‹ç™¼æ•ˆç‡**ï¼šç„¡éœ€åˆ‡æ›åˆ° Supabase æ§åˆ¶å°

---

## ç‚ºä»€éº¼ä½¿ç”¨ MCP?

| å„ªå‹¢         | èªªæ˜                                     |
| ------------ | ---------------------------------------- |
| **é–‹ç™¼æ•ˆç‡** | åœ¨ Claude Code ä¸­ç›´æ¥æŸ¥çœ‹å’Œæ“ä½œè³‡æ–™åº«    |
| **æ¸›å°‘éŒ¯èª¤** | Claude å¯ä»¥é©—è­‰ SQL èªæ³•å’Œ schema ä¸€è‡´æ€§ |
| **å¯¦æ™‚åé¥‹** | å³æ™‚çœ‹åˆ°è³‡æ–™åº«è®ŠåŒ–å’ŒæŸ¥è©¢çµæœ             |
| **è‡ªå‹•åŒ–**   | è‡ªå‹•ç”Ÿæˆ TypeScript é¡å‹ã€é·ç§»ç­‰         |

---

## å‰ç½®è¦æ±‚

åœ¨é–‹å§‹ä¹‹å‰ï¼Œç¢ºä¿ä½ å·²ç¶“æº–å‚™å¥½ï¼š

- âœ… Supabase å¸³æˆ¶ï¼ˆå·²æœ‰ Flourish å°ˆæ¡ˆï¼‰
- âœ… Supabase å°ˆæ¡ˆè¨ªå•æ¬Šé™
- âœ… Claude Code å·²å®‰è£ï¼ˆCLI æˆ– IDEï¼‰

---

## Step 1: ç²å– Supabase è¨ªå•ä»¤ç‰Œ

### 1.1 ç™»å…¥ Supabase æ§åˆ¶å°

1. è¨ªå• [Supabase Dashboard](https://app.supabase.com)
2. ä½¿ç”¨ä½ çš„å¸³æˆ¶ç™»å…¥
3. ï¼ˆå¯é¸ï¼‰é¸æ“‡ **Flourish** å°ˆæ¡ˆ

### 1.2 ç”Ÿæˆå€‹äººè¨ªå•ä»¤ç‰Œ

1. åœ¨ Supabase æ§åˆ¶å°ä¸­ï¼Œé»æ“Šå³ä¸Šè§’çš„ **å¸³æˆ¶åœ–ç¤º**
2. é¸æ“‡ **Settings** â†’ **Access Tokens**
3. é»æ“Š **Create Token** æŒ‰éˆ•
4. è¨­ç½®ä»¤ç‰Œè©³æƒ…ï¼š
   - **Token Name**: `claude-code-mcp` ï¼ˆæˆ–é¡ä¼¼çš„æè¿°æ€§åç¨±ï¼‰
   - **Expiration**: é¸æ“‡åˆé©çš„éæœŸæ™‚é–“ï¼ˆå»ºè­° 90 å¤©æˆ–æ›´é•·ï¼‰
   - **Scopes**: é è¨­æ¬Šé™å³å¯

5. é»æ“Š **Create Token**
6. **ç«‹å³è¤‡è£½ä»¤ç‰Œå€¼**ï¼ˆä¹‹å¾Œä¸æœƒå†é¡¯ç¤ºï¼‰

### 1.3 é©—è­‰ä»¤ç‰Œæ ¼å¼

Supabase è¨ªå•ä»¤ç‰Œçœ‹èµ·ä¾†åƒï¼š

```
sbp_4906976e8f289d7aff20288559ec10495870cd61
```

æ³¨æ„ `sbp_` å‰ç¶´å’Œé•·å­—ç¬¦ä¸²ï¼ˆç´„ 44 å€‹å­—ç¬¦ï¼‰ã€‚

---

## Step 2: é…ç½® Claude Code

### 2.1 æ‰¾åˆ°é…ç½®æ–‡ä»¶

Claude Code çš„é…ç½®æ–‡ä»¶ä½æ–¼ï¼š

```bash
~/.claude.json
```

é€™å€‹æ–‡ä»¶åŒ…å«æ‰€æœ‰å°ˆæ¡ˆçš„ MCP é…ç½®ã€‚

### 2.2 ç·¨è¼¯é…ç½®æ–‡ä»¶

æ‰“é–‹ `~/.claude.json`ï¼Œæ‰¾åˆ° Flourish å°ˆæ¡ˆçš„é…ç½®æ®µè½ï¼š

```json
"/Users/YOUR_USERNAME/personal/flourish": {
  "mcpServers": {
    // ç¾æœ‰çš„ MCP ä¼ºæœå™¨...
  }
}
```

### 2.3 æ·»åŠ  Supabase MCP

åœ¨ `mcpServers` ä¸­æ·»åŠ  Supabase é…ç½®ï¼š

```json
"/Users/YOUR_USERNAME/personal/flourish": {
  "mcpServers": {
    "supabase": {
      "type": "http",
      "url": "https://mcp.supabase.com/mcp?project_ref=fstcioczrehqtcbdzuij",
      "headers": {
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      }
    }
  }
}
```

**æ›¿æ›ä»¥ä¸‹å…§å®¹**ï¼š

- `YOUR_USERNAME`ï¼šä½ çš„ macOS ç”¨æˆ¶å
- `YOUR_TOKEN_HERE`ï¼šStep 1.2 ä¸­è¤‡è£½çš„ä»¤ç‰Œå€¼

### 2.4 å®Œæ•´é…ç½®ç¤ºä¾‹

```json
"/Users/henrylee/personal/flourish": {
  "allowedTools": [],
  "mcpContextUris": [],
  "mcpServers": {
    "chrome-devtools": {
      "type": "stdio",
      "command": "npx",
      "args": ["chrome-devtools-mcp@latest"],
      "env": {}
    },
    "supabase": {
      "type": "http",
      "url": "https://mcp.supabase.com/mcp?project_ref=fstcioczrehqtcbdzuij",
      "headers": {
        "Authorization": "Bearer sbp_4906976e8f289d7aff20288559ec10495870cd61"
      }
    }
  }
}
```

### 2.5 ä¿å­˜é…ç½®

ä¿å­˜ `~/.claude.json` æ–‡ä»¶ã€‚

---

## Step 3: æ¸¬è©¦ MCP é€£æ¥

### 3.1 é‡å•Ÿ Claude Code

**å®Œå…¨é€€å‡ºä¸¦é‡æ–°å•Ÿå‹• Claude Code**ï¼Œè®“æ–°é…ç½®ç”Ÿæ•ˆã€‚

### 3.2 åœ¨ Claude Code ä¸­æ¸¬è©¦

æ‰“é–‹ Flourish å°ˆæ¡ˆï¼Œåœ¨å°è©±ä¸­è¼¸å…¥ï¼š

```
åˆ—å‡º Supabase ä¸­çš„æ‰€æœ‰è¡¨
```

æˆ–ï¼š

```
æª¢æŸ¥ Supabase è³‡æ–™åº«ç‹€æ…‹
```

### 3.3 é æœŸçµæœ

å¦‚æœé…ç½®æˆåŠŸï¼ŒClaude æœƒåˆ—å‡ºæ‰€æœ‰è³‡æ–™åº«è¡¨ï¼š

```
âœ… æˆåŠŸé€£æ¥åˆ° Supabaseï¼

è³‡æ–™åº«è¡¨ï¼š
- users
- cards
- categories
- statements
- transactions
- recurring_expenses
- saving_rules
```

---

## å¸¸è¦‹å•é¡Œ

### Q1: æˆ‘çœ‹åˆ° "Server 'supabase' not found" éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. æª¢æŸ¥ `~/.claude.json` é…ç½®æ˜¯å¦æ­£ç¢º
2. ç¢ºèªå°ˆæ¡ˆè·¯å¾‘æ˜¯å¦æ­£ç¢ºï¼ˆä½¿ç”¨çµ•å°è·¯å¾‘ï¼‰
3. å®Œå…¨é‡å•Ÿ Claude Codeï¼ˆä¸åªæ˜¯é‡æ–°è¼‰å…¥çª—å£ï¼‰
4. æª¢æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¢ºï¼ˆæ²’æœ‰å¤šé¤˜çš„é€—è™Ÿæˆ–æ‹¬è™Ÿï¼‰

### Q2: ä»¤ç‰ŒéæœŸäº†æ€éº¼è¾¦ï¼Ÿ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. å›åˆ° Supabase æ§åˆ¶å° â†’ Settings â†’ Access Tokens
2. åˆªé™¤èˆŠä»¤ç‰Œ
3. å»ºç«‹æ–°ä»¤ç‰Œ
4. æ›´æ–° `~/.claude.json` ä¸­çš„ä»¤ç‰Œå€¼
5. é‡æ–°å•Ÿå‹• Claude Code

### Q3: å¯ä»¥ä½¿ç”¨ç’°å¢ƒè®Šæ•¸å—ï¼Ÿ

**ç­”æ¡ˆ**ï¼šæŠ€è¡“ä¸Šå¯èƒ½ï¼Œä½†ä¸æ¨è–¦ã€‚

- `~/.claude.json` ä¸æœƒè¢« git è¿½è¹¤ï¼Œç¡¬ç·¨ç¢¼æ˜¯å®‰å…¨çš„
- HTTP é¡å‹çš„ MCP å¯èƒ½ä¸æ”¯æŒç’°å¢ƒè®Šæ•¸æ›¿æ›
- ç›´æ¥ç¡¬ç·¨ç¢¼æ›´ç°¡å–®ã€æ›´å¯é 

### Q4: é…ç½®æœƒè¢«æäº¤åˆ° Git å—ï¼Ÿ

**ç­”æ¡ˆ**ï¼šä¸æœƒã€‚

- `~/.claude.json` åœ¨ä½ çš„å€‹äººç›®éŒ„ï¼Œä¸åœ¨å°ˆæ¡ˆä¸­
- å°ˆæ¡ˆçš„ `.claude/` ç›®éŒ„ä¸åŒ…å« MCP é…ç½®
- `.gitignore` å·²åŒ…å«æ‰€æœ‰æ•æ„Ÿé…ç½®æ–‡ä»¶

### Q5: çœ‹ä¸åˆ°æˆ‘çš„æ•¸æ“š

**å¯èƒ½åŸå› **ï¼š

- âŒ è³‡æ–™åº«è¡¨ä¸­æ²’æœ‰æ•¸æ“šï¼ˆæ­£å¸¸ï¼Œç›®å‰é‚„åœ¨é–‹ç™¼éšæ®µï¼‰
- âŒ Row Level Security (RLS) ç­–ç•¥é˜»æ“‹äº†æŸ¥è©¢ï¼ˆSprint 0.9.2 æœƒè¨­ç½®ï¼‰

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```sql
-- åœ¨ Supabase SQL Editor ä¸­æª¢æŸ¥è¡¨å…§å®¹
SELECT * FROM users LIMIT 5;
```

---

## å®‰å…¨æ€§èªªæ˜

### âœ… å®‰å…¨çš„åšæ³•

| é …ç›®                      | èªªæ˜                                |
| ------------------------- | ----------------------------------- |
| **~/.claude.json ç¡¬ç·¨ç¢¼** | é€™å€‹æ–‡ä»¶åœ¨å€‹äººç›®éŒ„ï¼Œä¸æœƒè¢« git è¿½è¹¤ |
| **é™åˆ¶ä»¤ç‰Œæ¬Šé™**          | åªæˆäºˆå¿…è¦çš„ Supabase æ¬Šé™          |
| **å®šæœŸè¼ªæ›**              | æ¯ 90 å¤©æ›´æ–°ä¸€æ¬¡ä»¤ç‰Œ                |
| **å€‹äººä»¤ç‰Œ**              | æ¯å€‹é–‹ç™¼è€…ä½¿ç”¨è‡ªå·±çš„ä»¤ç‰Œ            |

### âŒ ä¸å®‰å…¨çš„åšæ³•

| é …ç›®                      | åŸå›                              |
| ------------------------- | -------------------------------- |
| **æäº¤ä»¤ç‰Œåˆ° Git**        | æœƒæš´éœ²çµ¦æ‰€æœ‰æœ‰ repo è¨ªå•æ¬Šé™çš„äºº |
| **å…±äº«ä»¤ç‰Œ**              | ç„¡æ³•è¿½è¹¤èª°åšäº†ä»€éº¼æ“ä½œ           |
| **ä½¿ç”¨ Service Role Key** | æ¬Šé™éå¤§ï¼Œæ‡‰åªåœ¨å¾Œç«¯ä½¿ç”¨         |
| **åœ¨æ—¥èªŒä¸­æ‰“å°ä»¤ç‰Œ**      | å¯èƒ½æš´éœ²åœ¨æ§åˆ¶å°è¼¸å‡ºä¸­           |

### ä»¤ç‰Œè¼ªæ›æµç¨‹

```bash
# 1. åœ¨ Supabase æ§åˆ¶å°å»ºç«‹æ–°ä»¤ç‰Œ

# 2. æ›´æ–° ~/.claude.json
vim ~/.claude.json
# æ‰¾åˆ° "Authorization": "Bearer sbp_..."
# æ›¿æ›ç‚ºæ–°ä»¤ç‰Œ

# 3. é‡å•Ÿ Claude Code

# 4. æ¸¬è©¦é€£æ¥
# åœ¨ Claude Code ä¸­ï¼šåˆ—å‡º Supabase è¡¨

# 5. åˆªé™¤èˆŠä»¤ç‰Œï¼ˆåœ¨ Supabase æ§åˆ¶å°ï¼‰
```

---

## MCP é…ç½®æ¶æ§‹

### æ­£ç¢ºçš„é…ç½®å±¤ç´š

```
~/.claude.json (ä¸»é…ç½®æ–‡ä»¶)
â””â”€â”€ /Users/henrylee/personal/flourish (å°ˆæ¡ˆé…ç½®)
    â””â”€â”€ mcpServers (MCP ä¼ºæœå™¨åˆ—è¡¨)
        â”œâ”€â”€ chrome-devtools (stdio é¡å‹)
        â””â”€â”€ supabase (http é¡å‹)
            â”œâ”€â”€ url: https://mcp.supabase.com/mcp?project_ref=...
            â””â”€â”€ headers: Authorization: Bearer sbp_...
```

### æª”æ¡ˆç”¨é€”èªªæ˜

| æª”æ¡ˆ                          | ç”¨é€”                           | Git è¿½è¹¤            |
| ----------------------------- | ------------------------------ | ------------------- |
| `~/.claude.json`              | Claude Code ä¸»é…ç½®ï¼ˆåŒ…å« MCPï¼‰ | âŒ å¦               |
| `.claude/settings.local.json` | å°ˆæ¡ˆæœ¬åœ°è¨­ç½®ï¼ˆæ¬Šé™ç­‰ï¼‰         | âŒ å¦ï¼ˆgitignoredï¼‰ |
| `.env.local`                  | ç’°å¢ƒè®Šæ•¸ï¼ˆé MCP ç”¨ï¼‰          | âŒ å¦ï¼ˆgitignoredï¼‰ |
| `CLAUDE.md`                   | Claude Code å°ˆæ¡ˆæŒ‡å—           | âœ… æ˜¯               |

---

## ç›¸é—œè³‡æº

### å®˜æ–¹æ–‡æª”

- ğŸ“„ [Supabase MCP å®˜æ–¹æ–‡æª”](https://supabase.com/docs/guides/getting-started/mcp)
- ğŸ“„ [Claude Code MCP æŒ‡å—](https://docs.claude.com/en/docs/claude-code/mcp)
- ğŸ“„ [MCP å®˜æ–¹è¦ç¯„](https://modelcontextprotocol.io/)

### Flourish å°ˆæ¡ˆæ–‡æª”

- ğŸ“„ [Sprint 0.9 è©³ç´°è¦åŠƒ](../sprints/sprint-0-foundation/0.9-supabase-migration-plan.md)
- ğŸ“„ [ADR 001 - æ¶æ§‹ç°¡åŒ–](../decisions/001-architecture-simplification.md)
- ğŸ“„ [éƒ¨ç½²æ–‡æª”](../deployment/README.md)

### Supabase è³‡æº

- ğŸ“„ [Supabase æ§åˆ¶å°](https://app.supabase.com)
- ğŸ“„ [Flourish å°ˆæ¡ˆ](https://app.supabase.com/project/fstcioczrehqtcbdzuij)

---

## ç–‘é›£æ’è§£

### æª¢æŸ¥æ¸…å–®

åœ¨è¯ç¹«æ”¯æ´ä¹‹å‰ï¼Œç¢ºèªä»¥ä¸‹äº‹é …ï¼š

- [ ] `~/.claude.json` æª”æ¡ˆå­˜åœ¨ä¸”æ ¼å¼æ­£ç¢º
- [ ] ä»¤ç‰Œæ ¼å¼æ­£ç¢ºï¼ˆ`sbp_` é–‹é ­ï¼Œç´„ 44 å­—ç¬¦ï¼‰
- [ ] ä»¤ç‰ŒæœªéæœŸï¼ˆåœ¨ Supabase æ§åˆ¶å°æª¢æŸ¥ï¼‰
- [ ] å°ˆæ¡ˆè·¯å¾‘æ­£ç¢ºï¼ˆä½¿ç”¨çµ•å°è·¯å¾‘ï¼‰
- [ ] JSON æ ¼å¼æ­£ç¢ºï¼ˆä½¿ç”¨ [JSONLint](https://jsonlint.com/) é©—è­‰ï¼‰
- [ ] Claude Code å·²å®Œå…¨é‡å•Ÿï¼ˆä¸åªæ˜¯é‡æ–°è¼‰å…¥ï¼‰

### é™¤éŒ¯æ­¥é©Ÿ

1. **é©—è­‰é…ç½®æ–‡ä»¶**ï¼š

   ```bash
   cat ~/.claude.json | jq '.projects["/Users/henrylee/personal/flourish"].mcpServers.supabase'
   ```

2. **æª¢æŸ¥ä»¤ç‰Œ**ï¼š
   - é•·åº¦æ‡‰ç‚º 44 å­—ç¬¦
   - ä»¥ `sbp_` é–‹é ­
   - æ²’æœ‰å¤šé¤˜çš„ç©ºæ ¼æˆ–æ›è¡Œ

3. **æ¸¬è©¦ Supabase é€£æ¥**ï¼š
   - è¨ªå• [Supabase æ§åˆ¶å°](https://app.supabase.com)
   - ç¢ºèªå¯ä»¥æ­£å¸¸ç™»å…¥å’Œè¨ªå•å°ˆæ¡ˆ

4. **æŸ¥çœ‹ Claude Code æ—¥èªŒ**ï¼š
   - æª¢æŸ¥æ˜¯å¦æœ‰ MCP ç›¸é—œéŒ¯èª¤è¨Šæ¯

---

## æ”¯æ´èˆ‡åé¥‹

é‡åˆ°å•é¡Œæˆ–æœ‰å»ºè­°ï¼Ÿ

- ğŸ› **å ±å‘Šå•é¡Œ**ï¼š[GitHub Issues](https://github.com/henrylee-work/flourish/issues)
- ğŸ’¬ **è¨è«–**ï¼š[GitHub Discussions](https://github.com/henrylee-work/flourish/discussions)

---

**ç¶­è­·è€…**ï¼šHenry Lee
**æœ€å¾Œæ›´æ–°**ï¼š2025-11-12
**ç‰ˆæœ¬**ï¼š2.0 (å·²é©—è­‰å¯ç”¨)
