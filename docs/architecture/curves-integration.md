# æ›²ç·šåœ–å·¥å…·èˆ‡æ•´åˆè¨­è¨ˆ

## ğŸ“ˆ ä»€éº¼æ˜¯å±±é”åŸºçš„ç‹€æ³å…¬å¼ï¼Ÿ

### èƒŒæ™¯

**å±±é”åŸºï¼ˆScientologyï¼‰** æ˜¯ä¸€å€‹å®—æ•™å’Œå“²å­¸ç³»çµ±ï¼Œå…¶ä¸­åŒ…å«ä¸€å¥—ç®¡ç†å’Œçµ„ç¹”çš„æ–¹æ³•è«–ã€‚å…¶ä¸­ä¸€å€‹æ ¸å¿ƒæ¦‚å¿µæ˜¯ **ç‹€æ³å…¬å¼ï¼ˆCondition Formulasï¼‰**ï¼Œç”¨æ–¼è©•ä¼°å’Œæ”¹å–„å€‹äººã€åœ˜éšŠæˆ–çµ„ç¹”çš„è¡¨ç¾ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

ç‹€æ³å…¬å¼åŸºæ–¼ã€Œçµ±è¨ˆæ•¸æ“šã€ä¾†åˆ¤æ–·ç•¶å‰çš„ã€Œç‹€æ³ã€ï¼Œä¸¦æä¾›ç›¸æ‡‰çš„è¡Œå‹•æ­¥é©Ÿã€‚

#### çµ±è¨ˆæ•¸æ“šï¼ˆStatisticsï¼‰

- ä»»ä½•å¯é‡åŒ–çš„æŒ‡æ¨™ï¼ˆå¦‚ï¼šæ”¶å…¥ã€ç”¢å‡ºã€éŠ·å”®é‡ã€å®Œæˆçš„ä»»å‹™æ•¸ç­‰ï¼‰
- é€éæ™‚é–“åºåˆ—åœ–è¡¨ï¼ˆæ›²ç·šï¼‰ä¾†è¿½è¹¤è¶¨å‹¢
- è§€å¯Ÿæ•¸æ“šçš„ **ä¸Šå‡**ã€**ä¸‹é™** æˆ– **æŒå¹³**

#### ç‹€æ³ç­‰ç´šï¼ˆConditionsï¼‰

æ ¹æ“šçµ±è¨ˆæ›²ç·šçš„è¶¨å‹¢ï¼Œåˆ¤å®šç•¶å‰æ‰€è™•çš„ç‹€æ³ï¼š

1. **Powerï¼ˆæ¬ŠåŠ›ï¼‰**ï¼šçµ±è¨ˆæŒçºŒåœ¨éå¸¸é«˜çš„æ°´å¹³
2. **Affluenceï¼ˆå¯Œè£•ï¼‰**ï¼šçµ±è¨ˆçªç„¶å¤§å¹…ä¸Šå‡
3. **Normal Operationï¼ˆæ­£å¸¸é‹ä½œï¼‰**ï¼šçµ±è¨ˆç©©å®šä¸Šå‡
4. **Emergencyï¼ˆç·Šæ€¥ï¼‰**ï¼šçµ±è¨ˆé–‹å§‹ä¸‹é™
5. **Dangerï¼ˆå±éšªï¼‰**ï¼šçµ±è¨ˆæŒçºŒä¸‹é™
6. **Non-Existenceï¼ˆä¸å­˜åœ¨ï¼‰**ï¼šæ–°é–‹å§‹æˆ–çµ±è¨ˆç‚ºé›¶
7. **Liabilityï¼ˆè² å‚µï¼‰**ï¼šçµ±è¨ˆåš´é‡ä¸‹é™ä¸”å°ä»–äººé€ æˆæå®³
8. **Doubtï¼ˆæ‡·ç–‘ï¼‰**ï¼šä¸ç¢ºå®šç‹€æ³æˆ–éœ€è¦åšå‡ºé¸æ“‡
9. **Enemyï¼ˆæ•µå°ï¼‰**ï¼šæ˜ç¢ºçš„ç ´å£è¡Œç‚º
10. **Treasonï¼ˆå›åœ‹ï¼‰**ï¼šèƒŒå›

### ç‹€æ³å…¬å¼çš„æ‡‰ç”¨

æ¯å€‹ç‹€æ³ç­‰ç´šéƒ½æœ‰å°æ‡‰çš„ã€Œå…¬å¼ã€ï¼ˆæ­¥é©Ÿï¼‰ï¼Œå‘Šè¨´ä½ è©²åšä»€éº¼ä¾†æ”¹å–„æˆ–ç¶­æŒç‹€æ³ã€‚

#### ç¯„ä¾‹ï¼šEmergencyï¼ˆç·Šæ€¥ï¼‰å…¬å¼

ç•¶ä½ çš„çµ±è¨ˆæ•¸æ“šé–‹å§‹ä¸‹é™æ™‚ï¼š

1. **Promote**ï¼ˆæ¨å»£ï¼‰ï¼šç«‹å³æ¡å–è¡Œå‹•å¢åŠ ç”¢å‡º
2. **Change operating basis**ï¼ˆæ”¹è®Šé‹ä½œæ–¹å¼ï¼‰ï¼šèª¿æ•´ç­–ç•¥æˆ–æ–¹æ³•
3. **Economize**ï¼ˆç¯€ç´„ï¼‰ï¼šæ¸›å°‘ä¸å¿…è¦çš„é–‹æ”¯
4. **Prepare to deliver**ï¼ˆæº–å‚™äº¤ä»˜ï¼‰ï¼šç¢ºä¿èƒ½å¤ å±¥è¡Œæ‰¿è«¾
5. **Part with the past**ï¼ˆèˆ‡éå»å‘Šåˆ¥ï¼‰ï¼šæ”¾æ£„ç„¡æ•ˆçš„èˆŠæ–¹æ³•

#### ç¯„ä¾‹ï¼šAffluenceï¼ˆå¯Œè£•ï¼‰å…¬å¼

ç•¶çµ±è¨ˆçªç„¶å¤§å¹…ä¸Šå‡æ™‚ï¼š

1. **Economize**ï¼šä¸è¦å› ç‚ºæˆåŠŸå°±æµªè²»è³‡æº
2. **Pay debts**ï¼šå„Ÿé‚„éå»çš„å‚µå‹™
3. **Invest in expansion**ï¼šæŠ•è³‡æ–¼æ“´å±•
4. **Maintain the level**ï¼šç¶­æŒç•¶å‰çš„é«˜æ°´å¹³

### åœ¨è¨˜å¸³æ‡‰ç”¨ä¸­çš„æ‡‰ç”¨

åœ¨å€‹äººè²¡å‹™ç®¡ç†ä¸­ï¼Œå¯ä»¥å°‡é€™å¥—æ–¹æ³•è«–æ‡‰ç”¨æ–¼ï¼š

- **æ”¶å…¥æ›²ç·š**ï¼šè¿½è¹¤æ¯æœˆæ”¶å…¥è¶¨å‹¢ï¼Œåˆ¤æ–·è²¡å‹™ç‹€æ³
- **æ”¯å‡ºæ›²ç·š**ï¼šè¿½è¹¤æ”¯å‡ºè¶¨å‹¢ï¼Œè­˜åˆ¥éåº¦æ¶ˆè²»
- **å„²è“„æ›²ç·š**ï¼šè¿½è¹¤å„²è“„ç‡ï¼Œç¢ºä¿è²¡å‹™å¥åº·
- **æ·¨æ”¶å…¥æ›²ç·š**ï¼šæ”¶å…¥æ¸›å»æ”¯å‡ºï¼Œåˆ¤æ–·æ•´é«”è²¡å‹™ç‹€æ³

æ ¹æ“šæ›²ç·šè¶¨å‹¢ï¼Œè‡ªå‹•åˆ¤å®šç•¶å‰çš„ã€Œè²¡å‹™ç‹€æ³ã€ï¼Œä¸¦æä¾›ç›¸æ‡‰çš„å»ºè­°è¡Œå‹•ã€‚

---

## ğŸ› ï¸ ç¾æœ‰çš„ Curves Tool å°ˆæ¡ˆ

### å°ˆæ¡ˆæ¦‚è¦½

**ä½ç½®**ï¼š`/Users/henry_lee/Developer/Personal/curves_tool`

**æŠ€è¡“æ£§**ï¼š

- Next.js 14+ (App Router)
- TypeScript
- Supabaseï¼ˆèªè­‰ + è³‡æ–™åº«ï¼‰
- Tailwind CSS

### ç¾æœ‰åŠŸèƒ½ï¼ˆæ ¹æ“š READMEï¼‰

1. **æ›²ç·šåœ–ç¹ªè£½**ï¼šè¦–è¦ºåŒ–çµ±è¨ˆæ•¸æ“š
2. **ç‹€æ³åˆ¤å®š**ï¼šæ ¹æ“šè¶¨å‹¢åˆ¤æ–·ç•¶å‰ç‹€æ³ç­‰ç´š
3. **æ•¸æ“šè¿½è¹¤**ï¼šè¨˜éŒ„å’Œç®¡ç†å¤šå€‹çµ±è¨ˆé …ç›®
4. **è¶¨å‹¢åˆ†æ**ï¼šåˆ†ææ•¸æ“šè¶¨å‹¢ï¼ˆä¸Šå‡/ä¸‹é™/æŒå¹³ï¼‰

### å°ˆæ¡ˆçµæ§‹

```
curves_tool/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/           # Next.js App Router
â”‚   â”œâ”€â”€ components/    # React å…ƒä»¶
â”‚   â”œâ”€â”€ lib/           # å·¥å…·å‡½å¼
â”‚   â””â”€â”€ types/         # TypeScript é¡å‹
â”œâ”€â”€ public/
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## ğŸ”— èˆ‡è¨˜å¸³æ‡‰ç”¨çš„æ•´åˆç­–ç•¥

### æ•´åˆç›®æ¨™

1. **è¨˜å¸³æ•¸æ“šè‡ªå‹•ç”Ÿæˆæ›²ç·š**ï¼š
   - æ”¶å…¥æ›²ç·šï¼ˆæ¯æ—¥/æ¯é€±/æ¯æœˆï¼‰
   - æ”¯å‡ºæ›²ç·š
   - æ·¨æ”¶å…¥æ›²ç·š
   - å„åˆ†é¡æ”¯å‡ºæ›²ç·š

2. **ç‹€æ³è‡ªå‹•åˆ¤å®š**ï¼š
   - æ ¹æ“šè²¡å‹™è¶¨å‹¢è‡ªå‹•åˆ¤å®šè²¡å‹™ç‹€æ³
   - æä¾›æ”¹å–„å»ºè­°

3. **æ¨¡çµ„å¾©ç”¨**ï¼š
   - è¨˜å¸³æ‡‰ç”¨ä½¿ç”¨æ›²ç·šåœ–çš„ç¹ªè£½åŠŸèƒ½
   - æ›²ç·šå·¥å…·å¯ä»¥æ¥æ”¶è¨˜å¸³æ•¸æ“šé€²è¡Œæ·±åº¦åˆ†æ

### æ•´åˆæ–¹å¼ï¼šä¸‰å±¤æ¶æ§‹

#### ç¬¬ä¸€å±¤ï¼šå…±äº«æ ¸å¿ƒé‚è¼¯ï¼ˆ`packages/chart-engine`ï¼‰

å»ºç«‹ä¸€å€‹ç¨ç«‹çš„ packageï¼ŒåŒ…å«æ›²ç·šåœ–çš„æ ¸å¿ƒé‚è¼¯ï¼š

```
packages/chart-engine/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ curve-calculator.ts      # æ›²ç·šè¨ˆç®—
â”‚   â”‚   â”œâ”€â”€ trend-analyzer.ts        # è¶¨å‹¢åˆ†æ
â”‚   â”‚   â”œâ”€â”€ condition-detector.ts    # ç‹€æ³åˆ¤å®š
â”‚   â”‚   â””â”€â”€ statistics.ts            # çµ±è¨ˆè¨ˆç®—
â”‚   â”œâ”€â”€ renderers/
â”‚   â”‚   â”œâ”€â”€ chart-renderer.ts        # åœ–è¡¨æ¸²æŸ“é‚è¼¯
â”‚   â”‚   â””â”€â”€ chart-config.ts          # åœ–è¡¨é…ç½®
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ data-point.ts
â”‚   â”‚   â”œâ”€â”€ condition.ts
â”‚   â”‚   â””â”€â”€ trend.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**æ ¸å¿ƒä»‹é¢è¨­è¨ˆ**ï¼š

```typescript
// packages/chart-engine/src/types/data-point.ts
export interface DataPoint {
  date: Date;
  value: number;
  label?: string;
}

export interface TimeSeries {
  id: string;
  name: string;
  data: DataPoint[];
  unit?: string; // å–®ä½ï¼ˆå¦‚ï¼šå…ƒã€ç­†ï¼‰
}

// packages/chart-engine/src/types/condition.ts
export enum ConditionLevel {
  POWER = 'power',
  AFFLUENCE = 'affluence',
  NORMAL = 'normal',
  EMERGENCY = 'emergency',
  DANGER = 'danger',
  NON_EXISTENCE = 'non-existence',
  // ... å…¶ä»–ç‹€æ³
}

export interface ConditionResult {
  level: ConditionLevel;
  trend: 'up' | 'down' | 'flat';
  changeRate: number; // è®ŠåŒ–ç‡ï¼ˆ%ï¼‰
  recommendation: string[]; // å»ºè­°è¡Œå‹•
}

// packages/chart-engine/src/types/trend.ts
export interface TrendAnalysis {
  trend: 'up' | 'down' | 'flat';
  slope: number; // æ–œç‡
  changeRate: number; // è®ŠåŒ–ç‡
  average: number; // å¹³å‡å€¼
  volatility: number; // æ³¢å‹•æ€§
}
```

**æ ¸å¿ƒåŠŸèƒ½å¯¦ä½œ**ï¼š

```typescript
// packages/chart-engine/src/core/trend-analyzer.ts
export class TrendAnalyzer {
  /**
   * åˆ†ææ™‚é–“åºåˆ—çš„è¶¨å‹¢
   */
  analyze(timeSeries: TimeSeries): TrendAnalysis {
    const data = timeSeries.data;

    // è¨ˆç®—å¹³å‡å€¼
    const average = this.calculateAverage(data);

    // è¨ˆç®—è¶¨å‹¢ï¼ˆç·šæ€§å›æ­¸ï¼‰
    const slope = this.calculateSlope(data);

    // åˆ¤å®šè¶¨å‹¢æ–¹å‘
    const trend = this.determineTrend(slope);

    // è¨ˆç®—è®ŠåŒ–ç‡
    const changeRate = this.calculateChangeRate(data);

    // è¨ˆç®—æ³¢å‹•æ€§ï¼ˆæ¨™æº–å·®ï¼‰
    const volatility = this.calculateVolatility(data, average);

    return {
      trend,
      slope,
      changeRate,
      average,
      volatility,
    };
  }

  private calculateAverage(data: DataPoint[]): number {
    const sum = data.reduce((acc, point) => acc + point.value, 0);
    return sum / data.length;
  }

  private calculateSlope(data: DataPoint[]): number {
    // ç·šæ€§å›æ­¸è¨ˆç®—æ–œç‡
    // y = mx + bï¼Œæ±‚ m
    const n = data.length;
    if (n < 2) return 0;

    const xValues = data.map((_, i) => i);
    const yValues = data.map((point) => point.value);

    const sumX = xValues.reduce((a, b) => a + b, 0);
    const sumY = yValues.reduce((a, b) => a + b, 0);
    const sumXY = xValues.reduce((sum, x, i) => sum + x * yValues[i], 0);
    const sumXX = xValues.reduce((sum, x) => sum + x * x, 0);

    const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
    return slope;
  }

  private determineTrend(slope: number): 'up' | 'down' | 'flat' {
    const threshold = 0.01; // å¯èª¿æ•´çš„é–¾å€¼
    if (slope > threshold) return 'up';
    if (slope < -threshold) return 'down';
    return 'flat';
  }

  private calculateChangeRate(data: DataPoint[]): number {
    if (data.length < 2) return 0;

    const firstValue = data[0].value;
    const lastValue = data[data.length - 1].value;

    if (firstValue === 0) return 0;

    return ((lastValue - firstValue) / firstValue) * 100;
  }

  private calculateVolatility(data: DataPoint[], average: number): number {
    const variance =
      data.reduce((sum, point) => {
        const diff = point.value - average;
        return sum + diff * diff;
      }, 0) / data.length;

    return Math.sqrt(variance);
  }
}
```

```typescript
// packages/chart-engine/src/core/condition-detector.ts
export class ConditionDetector {
  /**
   * æ ¹æ“šè¶¨å‹¢åˆ†æåˆ¤å®šç‹€æ³ç­‰ç´š
   */
  detect(analysis: TrendAnalysis, previousAnalysis?: TrendAnalysis): ConditionResult {
    const { trend, changeRate } = analysis;

    let level: ConditionLevel;
    let recommendation: string[] = [];

    // åˆ¤å®šé‚è¼¯
    if (trend === 'up' && changeRate > 50) {
      // çªç„¶å¤§å¹…ä¸Šå‡
      level = ConditionLevel.AFFLUENCE;
      recommendation = [
        'æ­å–œï¼è²¡å‹™ç‹€æ³å¤§å¹…æ”¹å–„',
        'å»ºè­°ï¼šå„Ÿé‚„å‚µå‹™ä¸¦æŠ•è³‡æ–¼æœªä¾†',
        'ä¸è¦å› ç‚ºæˆåŠŸå°±éåº¦æ¶ˆè²»',
        'ç¶­æŒç•¶å‰çš„è‰¯å¥½ç¿’æ…£',
      ];
    } else if (trend === 'up' && changeRate > 10) {
      // ç©©å®šä¸Šå‡
      level = ConditionLevel.NORMAL;
      recommendation = ['è²¡å‹™ç‹€æ³æ­£å¸¸é‹ä½œ', 'ç¹¼çºŒä¿æŒç•¶å‰çš„æ”¶æ”¯æ¨¡å¼', 'å¯ä»¥è€ƒæ…®å¢åŠ å„²è“„æˆ–æŠ•è³‡'];
    } else if (trend === 'flat') {
      // æŒå¹³
      level = ConditionLevel.NORMAL;
      recommendation = ['è²¡å‹™ç‹€æ³ç©©å®š', 'è€ƒæ…®å°‹æ‰¾å¢åŠ æ”¶å…¥çš„æ©Ÿæœƒ'];
    } else if (trend === 'down' && changeRate > -10) {
      // é–‹å§‹ä¸‹é™
      level = ConditionLevel.EMERGENCY;
      recommendation = [
        'è­¦å‘Šï¼šè²¡å‹™ç‹€æ³é–‹å§‹ä¸‹é™',
        'ç«‹å³æ¡å–è¡Œå‹•ï¼šæ¸›å°‘éå¿…è¦æ”¯å‡º',
        'å°‹æ‰¾å¢åŠ æ”¶å…¥çš„æ–¹æ³•',
        'æª¢è¦–ä¸¦èª¿æ•´é ç®—',
      ];
    } else if (trend === 'down' && changeRate <= -10) {
      // æŒçºŒä¸‹é™
      level = ConditionLevel.DANGER;
      recommendation = [
        'å±éšªï¼šè²¡å‹™ç‹€æ³åš´é‡ä¸‹é™',
        'ç·Šæ€¥è¡Œå‹•ï¼šå¤§å¹…å‰Šæ¸›æ”¯å‡º',
        'åœæ­¢æ‰€æœ‰éå¿…è¦æ¶ˆè²»',
        'è€ƒæ…®è®Šè³£è³‡ç”¢æˆ–å°‹æ±‚å”åŠ©',
        'åˆ¶å®šå‚µå‹™å„Ÿé‚„è¨ˆç•«',
      ];
    } else {
      level = ConditionLevel.NON_EXISTENCE;
      recommendation = ['é–‹å§‹è¨˜éŒ„ä½ çš„è²¡å‹™æ•¸æ“š', 'è¨­å®šæ¸…æ™°çš„è²¡å‹™ç›®æ¨™'];
    }

    return {
      level,
      trend,
      changeRate,
      recommendation,
    };
  }

  /**
   * å–å¾—ç‹€æ³ç­‰ç´šçš„é¡¯ç¤ºè³‡è¨Š
   */
  getConditionInfo(level: ConditionLevel) {
    const infoMap = {
      [ConditionLevel.POWER]: {
        name: 'æ¬ŠåŠ›',
        color: 'green',
        description: 'è²¡å‹™ç‹€æ³æ¥µä½³ï¼ŒæŒçºŒç¶­æŒé«˜æ°´å¹³',
      },
      [ConditionLevel.AFFLUENCE]: {
        name: 'å¯Œè£•',
        color: 'blue',
        description: 'è²¡å‹™ç‹€æ³çªç„¶å¤§å¹…æ”¹å–„',
      },
      [ConditionLevel.NORMAL]: {
        name: 'æ­£å¸¸',
        color: 'green',
        description: 'è²¡å‹™ç‹€æ³ç©©å®šè‰¯å¥½',
      },
      [ConditionLevel.EMERGENCY]: {
        name: 'ç·Šæ€¥',
        color: 'yellow',
        description: 'è²¡å‹™ç‹€æ³é–‹å§‹æƒ¡åŒ–ï¼Œéœ€è¦ç«‹å³è¡Œå‹•',
      },
      [ConditionLevel.DANGER]: {
        name: 'å±éšª',
        color: 'red',
        description: 'è²¡å‹™ç‹€æ³åš´é‡æƒ¡åŒ–ï¼Œéœ€è¦ç·Šæ€¥è™•ç†',
      },
      [ConditionLevel.NON_EXISTENCE]: {
        name: 'ä¸å­˜åœ¨',
        color: 'gray',
        description: 'å°šæœªå»ºç«‹è²¡å‹™è¨˜éŒ„',
      },
    };

    return infoMap[level];
  }
}
```

#### ç¬¬äºŒå±¤ï¼šæ‡‰ç”¨å±¤æ•´åˆ

**åœ¨è¨˜å¸³æ‡‰ç”¨ä¸­ä½¿ç”¨ï¼ˆ`apps/ledger`ï¼‰**ï¼š

```typescript
// apps/ledger/src/lib/financial-analyzer.ts
import { TrendAnalyzer, ConditionDetector, TimeSeries, DataPoint } from '@workspace/chart-engine';
import { Transaction } from '@workspace/database';

export class FinancialAnalyzer {
  private trendAnalyzer = new TrendAnalyzer();
  private conditionDetector = new ConditionDetector();

  /**
   * å°‡äº¤æ˜“è¨˜éŒ„è½‰æ›ç‚ºæ™‚é–“åºåˆ—
   */
  transactionsToTimeSeries(
    transactions: Transaction[],
    type: 'income' | 'expense' | 'net',
    groupBy: 'day' | 'week' | 'month' = 'month'
  ): TimeSeries {
    // éæ¿¾å’Œåˆ†çµ„
    const filtered =
      type === 'net' ? transactions : transactions.filter((t) => t.type === type.toUpperCase());

    // æŒ‰æ™‚é–“åˆ†çµ„ä¸¦è¨ˆç®—ç¸½é¡
    const grouped = this.groupByPeriod(filtered, groupBy);

    const data: DataPoint[] = grouped.map((group) => ({
      date: group.date,
      value: group.total,
    }));

    return {
      id: type,
      name: type === 'income' ? 'æ”¶å…¥' : type === 'expense' ? 'æ”¯å‡º' : 'æ·¨æ”¶å…¥',
      data,
      unit: 'å…ƒ',
    };
  }

  /**
   * åˆ†æè²¡å‹™ç‹€æ³
   */
  analyzeFinancialCondition(transactions: Transaction[]) {
    // ç”Ÿæˆæ·¨æ”¶å…¥æ›²ç·š
    const netIncomeSeries = this.transactionsToTimeSeries(transactions, 'net');

    // åˆ†æè¶¨å‹¢
    const analysis = this.trendAnalyzer.analyze(netIncomeSeries);

    // åˆ¤å®šç‹€æ³
    const condition = this.conditionDetector.detect(analysis);

    return {
      analysis,
      condition,
      series: netIncomeSeries,
    };
  }

  private groupByPeriod(transactions: Transaction[], period: 'day' | 'week' | 'month') {
    // å¯¦ä½œåˆ†çµ„é‚è¼¯
    // ...
    return [];
  }
}
```

**åœ¨æ›²ç·šåœ–å·¥å…·ä¸­ä½¿ç”¨ï¼ˆ`apps/curves`ï¼‰**ï¼š

```typescript
// apps/curves/src/lib/data-importer.ts
import { TimeSeries } from '@workspace/chart-engine';

export class DataImporter {
  /**
   * å¾è¨˜å¸³æ‡‰ç”¨åŒ¯å…¥æ•¸æ“š
   */
  async importFromLedger(userId: string, dateRange: DateRange): Promise<TimeSeries[]> {
    // å‘¼å«è¨˜å¸³ API å–å¾—æ•¸æ“š
    const response = await fetch(
      `/api/ledger/export?userId=${userId}&from=${dateRange.from}&to=${dateRange.to}`
    );
    const data = await response.json();

    // è½‰æ›ç‚º TimeSeries æ ¼å¼
    return this.convertToTimeSeries(data);
  }

  private convertToTimeSeries(data: any): TimeSeries[] {
    // è½‰æ›é‚è¼¯
    return [];
  }
}
```

#### ç¬¬ä¸‰å±¤ï¼šè³‡æ–™æµæ•´åˆ

**é¸é … Aï¼šAPI åŒ¯å‡º/åŒ¯å…¥ï¼ˆæ¨è–¦åˆæœŸä½¿ç”¨ï¼‰**

1. è¨˜å¸³æ‡‰ç”¨æä¾›æ•¸æ“šåŒ¯å‡º APIï¼š

```typescript
// apps/api/src/ledger/ledger.controller.ts
@Controller('ledger')
export class LedgerController {
  @Get('export')
  @UseGuards(SupabaseAuthGuard)
  async exportData(
    @User() user,
    @Query('from') from: string,
    @Query('to') to: string,
    @Query('format') format: 'json' | 'csv' = 'json'
  ) {
    const transactions = await this.ledgerService.getTransactions(
      user.id,
      new Date(from),
      new Date(to)
    );

    // è½‰æ›ç‚ºçµ±è¨ˆæ›²ç·šæ ¼å¼
    const timeSeries = this.convertToTimeSeries(transactions);

    return {
      userId: user.id,
      dateRange: { from, to },
      timeSeries,
    };
  }
}
```

2. æ›²ç·šåœ–å·¥å…·åŒ¯å…¥æ•¸æ“šï¼š

```typescript
// åœ¨æ›²ç·šåœ–å·¥å…·ä¸­
const importFromLedger = async () => {
  const response = await fetch(`${LEDGER_API_URL}/ledger/export?from=...&to=...`, {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });

  const data = await response.json();
  // ä½¿ç”¨åŒ¯å…¥çš„æ•¸æ“šç¹ªè£½æ›²ç·š
};
```

**é¸é … Bï¼šå…±äº«è³‡æ–™åº«ï¼ˆæ·±åº¦æ•´åˆï¼‰**

1. åœ¨ `packages/database` å®šç¾©å…±äº«çš„ Statistics æ¨¡å‹ï¼š

```prisma
model Statistic {
  id        String   @id @default(uuid())
  userId    String
  name      String
  value     Decimal
  date      DateTime
  source    String   // 'ledger', 'manual', etc.
  category  String?
  createdAt DateTime @default(now())

  @@index([userId, date])
  @@index([userId, source])
}
```

2. è¨˜å¸³æ‡‰ç”¨è‡ªå‹•å¯«å…¥çµ±è¨ˆæ•¸æ“šï¼š

```typescript
// æ¯æ¬¡æœ‰æ–°äº¤æ˜“æ™‚ï¼Œæ›´æ–°çµ±è¨ˆ
await prisma.statistic.create({
  data: {
    userId: user.id,
    name: 'daily_income',
    value: transaction.amount,
    date: transaction.date,
    source: 'ledger',
    category: transaction.category?.name,
  },
});
```

3. æ›²ç·šåœ–å·¥å…·ç›´æ¥è®€å–ï¼š

```typescript
// å¾å…±äº«è³‡æ–™åº«è®€å–çµ±è¨ˆæ•¸æ“š
const stats = await prisma.statistic.findMany({
  where: {
    userId: user.id,
    source: 'ledger',
    date: { gte: from, lte: to },
  },
});
```

---

## ğŸ¨ UI/UX æ•´åˆ

### åœ¨è¨˜å¸³æ‡‰ç”¨ä¸­åµŒå…¥æ›²ç·šåœ–

```typescript
// apps/ledger/src/app/dashboard/page.tsx
import { ChartRenderer } from '@workspace/chart-engine';
import { FinancialAnalyzer } from '@/lib/financial-analyzer';

export default async function Dashboard() {
  const transactions = await getTransactions();
  const analyzer = new FinancialAnalyzer();

  const { analysis, condition, series } = analyzer.analyzeFinancialCondition(transactions);

  return (
    <div>
      <h1>è²¡å‹™å„€è¡¨æ¿</h1>

      {/* ç‹€æ³å¡ç‰‡ */}
      <ConditionCard condition={condition} />

      {/* æ›²ç·šåœ– */}
      <ChartRenderer data={series} />

      {/* å»ºè­°è¡Œå‹• */}
      <RecommendationList items={condition.recommendation} />

      {/* é€²éšåˆ†æé€£çµ */}
      <Link href="/curves">
        <Button>æŸ¥çœ‹é€²éšæ›²ç·šåˆ†æ</Button>
      </Link>
    </div>
  );
}
```

### å¾æ›²ç·šåœ–å·¥å…·è·³è½‰å›è¨˜å¸³

```typescript
// apps/curves/src/components/data-source-selector.tsx
export function DataSourceSelector() {
  return (
    <div>
      <h2>é¸æ“‡æ•¸æ“šä¾†æº</h2>
      <button onClick={() => importFromLedger()}>
        å¾è¨˜å¸³æ‡‰ç”¨åŒ¯å…¥
      </button>
      <button onClick={() => manualInput()}>
        æ‰‹å‹•è¼¸å…¥æ•¸æ“š
      </button>
    </div>
  );
}
```

---

## ğŸ“‹ å¯¦ä½œè¨ˆç•«

### Phase 1ï¼šå»ºç«‹ chart-engine packageï¼ˆSprint 4ï¼‰

- [ ] å»ºç«‹ `packages/chart-engine` çµæ§‹
- [ ] å¯¦ä½œ `TrendAnalyzer`
- [ ] å¯¦ä½œ `ConditionDetector`
- [ ] å®šç¾©æ ¸å¿ƒå‹åˆ¥å’Œä»‹é¢
- [ ] æ’°å¯«å–®å…ƒæ¸¬è©¦
- [ ] æ’°å¯«æ–‡æª”

### Phase 2ï¼šè¨˜å¸³æ‡‰ç”¨æ•´åˆï¼ˆSprint 5ï¼‰

- [ ] å¯¦ä½œ `FinancialAnalyzer`
- [ ] åœ¨å„€è¡¨æ¿é¡¯ç¤ºåŸºæœ¬æ›²ç·š
- [ ] é¡¯ç¤ºè²¡å‹™ç‹€æ³å’Œå»ºè­°
- [ ] å¯¦ä½œæ•¸æ“šåŒ¯å‡º API
- [ ] æ¸¬è©¦æ•´åˆ

### Phase 3ï¼šæ›²ç·šåœ–å·¥å…·é·ç§»ï¼ˆSprint 6ï¼‰

- [ ] å°‡ç¾æœ‰ curves_tool é·ç§»åˆ° monorepo
- [ ] é‡æ§‹ä»¥ä½¿ç”¨ chart-engine
- [ ] å¯¦ä½œæ•¸æ“šåŒ¯å…¥åŠŸèƒ½
- [ ] æ¸¬è©¦é›™å‘æ•´åˆ

### Phase 4ï¼šé€²éšåŠŸèƒ½ï¼ˆSprint 7+ï¼‰

- [ ] å¤šç¶­åº¦åˆ†æï¼ˆåˆ†é¡ã€å¸³æˆ¶ã€æ¨™ç±¤ï¼‰
- [ ] è‡ªè¨‚çµ±è¨ˆé …ç›®
- [ ] ç›®æ¨™è¨­å®šå’Œè¿½è¹¤
- [ ] é æ¸¬å’Œæ¨¡æ“¬

---

## ğŸ¯ ç¸½çµ

**æ•´åˆç­–ç•¥çš„æ ¸å¿ƒ**ï¼š

1. **æ¨¡çµ„åŒ–è¨­è¨ˆ**ï¼šé€é `chart-engine` package å…±äº«æ ¸å¿ƒé‚è¼¯
2. **é¬†è€¦åˆ**ï¼šå…©å€‹æ‡‰ç”¨ä¿æŒç¨ç«‹ï¼Œé€éæ¨™æº–ä»‹é¢é€šè¨Š
3. **æ¼¸é€²å¼æ•´åˆ**ï¼šå¾ç°¡å–®çš„ API åŒ¯å‡ºé–‹å§‹ï¼Œé€æ­¥æ·±åŒ–æ•´åˆ
4. **ä»¥ä½¿ç”¨è€…ç‚ºä¸­å¿ƒ**ï¼šåœ¨è¨˜å¸³æ‡‰ç”¨ä¸­æä¾›åŸºæœ¬åˆ†æï¼Œéœ€è¦æ·±åº¦åˆ†ææ™‚å¼•å°åˆ°æ›²ç·šåœ–å·¥å…·

**é æœŸæ•ˆæœ**ï¼š

- âœ… è¨˜å¸³æ‡‰ç”¨è‡ªå‹•ç”¢ç”Ÿè²¡å‹™æ›²ç·šå’Œç‹€æ³åˆ†æ
- âœ… æ›²ç·šåœ–å·¥å…·å¯ä»¥æ¥æ”¶è¨˜å¸³æ•¸æ“šé€²è¡Œæ·±åº¦åˆ†æ
- âœ… ç¨‹å¼ç¢¼å¾©ç”¨ï¼Œæ¸›å°‘é‡è¤‡é–‹ç™¼
- âœ… çµ±ä¸€çš„è³‡æ–™æ¨¡å‹å’Œåˆ†æé‚è¼¯
- âœ… ç‚ºæœªä¾†å¢åŠ æ›´å¤šå·¥å…·å¥ å®šåŸºç¤
