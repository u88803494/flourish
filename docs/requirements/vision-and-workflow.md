# Vision and Workflow

**Last Updated**: 2025-10-30
**Status**: Living Document

## Overview

Flourish is a personal finance management system designed for credit card power users who need efficient monthly statement processing and intelligent budget management with pre-deduction capabilities.

---

## User Profile and Context

### Target User

**Power Credit Card User**

- Owns 20+ credit cards for various rewards and benefits
- Actively uses 2-5 cards per month depending on promotions
- Processes statements monthly (not daily transaction entry)
- Values efficiency and automation over manual data entry
- Needs clear visibility of actual available budget after pre-deductions

### Historical Context

**Previous Solution**: Google Sheets (2019-2025)

- **Pain Points**:
  - Complex formulas for annual fee amortization (divide by 12)
  - Manual pre-deduction tracking for subscriptions
  - Difficult to maintain and rebuild annually
  - Unclear data purpose after several years
  - Time-consuming monthly reconciliation

**Data Volume**:

- 6 years of historical transaction data (2019-2025)
- Priority: Recent data (2024-2025) for immediate import
- Full history: Import when time permits

---

## Primary Workflow: PDF Statement Processing

### Monthly Cadence

```
ÊØèÊúàÂõ∫ÂÆöÊµÅÁ®ãÔºö
1. ‰∏ãËºâ‰ø°Áî®Âç° PDF Â∞çÂ∏≥ÂñÆÔºàÁ∂≤Ë∑ØÈäÄË°åÔºâ
2. ‰∏äÂÇ≥ PDF Âà∞ Flourish
3. AI Ëá™ÂãïËæ®Ë≠ò‰∫§ÊòìÊòéÁ¥∞
4. Ê™¢Ë¶ñ‰∏¶Á¢∫Ë™ç‰∫§ÊòìÔºà‰øÆÊ≠£ÈåØË™§Ôºâ
5. ÊâπÊ¨°ÂåØÂÖ•Âà∞Ë≥áÊñôÂ∫´
6. Ê™¢Ë¶ñÁï∂ÊúàÈ†êÁÆó‰ΩøÁî®ÁãÄÊ≥Å
```

### Workflow Details

#### Step 1: Statement Download

- Source: Online banking portals
- Format: PDF files (ÂêÑÂÆ∂ÈäÄË°åÊ†ºÂºè‰∏çÂêå)
- Frequency: Monthly, after statement date
- Cards: Only download for actively used cards (2-5 cards/month)

#### Step 2: PDF Upload

- **User Action**: Select card, upload PDF file
- **System Action**: Store PDF in cloud storage, create Statement record
- **UI Requirements**:
  - Card selection dropdown (show active cards first)
  - File upload with progress indicator
  - Support drag-and-drop
  - File size limit: 10MB per PDF

#### Step 3: AI Transaction Recognition

- **System Action**:
  - Extract transaction data using OCR/AI
  - Parse: date, merchant name, amount, transaction type
  - Calculate confidence score for each transaction
  - Link transactions to statement
- **Technology**: OpenAI Vision API (proposed)
- **Data Quality**: Store raw OCR text for verification

#### Step 4: Review and Validation

- **User Action**:
  - Review extracted transactions in table view
  - Edit merchant names (standardize naming)
  - Assign categories
  - Remove incorrect extractions
  - Flag suspicious transactions
- **UI Requirements**:
  - Editable table with inline editing
  - Show confidence score indicator
  - Bulk category assignment
  - Quick delete for incorrect items

#### Step 5: Batch Import

- **User Action**: Click "Confirm Import" button
- **System Action**:
  - Save all validated transactions to database
  - Mark statement as processed
  - Update monthly budget calculations
  - Trigger category statistics update
- **Validation**: Ensure no duplicate transactions

#### Step 6: Budget Review

- **User Action**: View monthly budget dashboard
- **Display Requirements**:
  - Total income for the month
  - Pre-deducted amounts (subscriptions, amortized fees, auto-savings)
  - Total spending from statements
  - **Actual available balance** (most important metric)
  - Category breakdown
  - Comparison with previous months

---

## Multi-Card Management

### Card Inventory

**Total Cards**: 20+ credit cards
**Active Cards**: 2-5 cards used per month
**Rotation Strategy**: Use different cards based on:

- Current promotions (cashback, points)
- Spending category bonuses
- Annual fee justification

### Card Management Requirements

#### Card Information

- Card name (user-defined, e.g., "ÂúãÊ≥∞‰∏ñËèØ CUBE")
- Bank name
- Last 4 digits
- Card color (for visual identification)
- Active/Inactive status

#### Active Card Management

- **Mark as Active**: Cards currently in wallet/use
- **Mark as Inactive**: Cards stored away, not in current rotation
- **Display Priority**: Show active cards first in all dropdowns

#### Statement Organization

- Link each statement to specific card
- Filter statements by card
- View card usage history
- Track spending patterns per card

---

## Pre-Deduction System

### Purpose

**Calculate actual available money** by pre-deducting expected future expenses from current income.

### Formula

```
ÂØ¶ÈöõÂèØÁî®ÈáëÈ°ç = Á∏ΩÊî∂ÂÖ• - Ëá™ÂãïÂÑ≤ËìÑ - Âõ∫ÂÆöÊúàË≤ª - ÂàÜÊî§Âπ¥Ë≤ª
```

### Pre-Deduction Categories

#### 1. Fixed Monthly Subscriptions

**Examples**:

- YouTube Premium: NT$179/Êúà
- Netflix: NT$390/Êúà
- iCloud Storage: NT$90/Êúà

**Behavior**:

- Auto-deduct from available budget
- Track actual vs expected transactions
- Alert if subscription amount changes
- Show in monthly budget projection

#### 2. Annual Fee Amortization

**Purpose**: Avoid budget shock from large annual charges

**Examples**:

- Credit card annual fee: NT$10,000/Âπ¥ ‚Üí NT$833/Êúà
- Domain renewal: NT$500/Âπ¥ ‚Üí NT$42/Êúà
- Professional membership: NT$5,000/Âπ¥ ‚Üí NT$417/Êúà

**Calculation**:

```
ÊØèÊúàÂàÜÊî§ÈáëÈ°ç = Âπ¥Â∫¶Ë≤ªÁî®Á∏ΩÈ°ç √∑ 12
```

**Behavior**:

- Display as monthly "reserved amount"
- When actual annual charge occurs, match against reserved amount
- Prevent double-counting (reserve vs actual)

#### 3. Automatic Savings Rules

**Purpose**: Enforce consistent saving behavior

**Examples**:

- Emergency fund: 5% of monthly income
- Investment fund: NT$5,000 fixed amount
- Retirement savings: 10% of income

**Types**:

- **Percentage-based**: % of income
- **Fixed amount**: Specific NT$ amount

**Calculation**:

```
ÂÑ≤ËìÑÈáëÈ°ç =
  (Êî∂ÂÖ• √ó ÁôæÂàÜÊØîË¶èÂâáÁ∏ΩÂíå) + Âõ∫ÂÆöÈáëÈ°çË¶èÂâáÁ∏ΩÂíå
```

---

## Budget Calculation and Display

### Monthly Budget Formula

```typescript
// Ê≠•È©ü 1: Ë®àÁÆóÁ∏ΩÊî∂ÂÖ•
const totalIncome = sumOfAllIncomeTransactions;

// Ê≠•È©ü 2: Ë®àÁÆóËá™ÂãïÂÑ≤ËìÑ
const autoSaving = totalIncome * savingPercentage + fixedSavingAmount;

// Ê≠•È©ü 3: Ë®àÁÆóÂõ∫ÂÆöÊúàË≤ªÁ∏ΩÈ°ç
const monthlySubscriptions = sumOfRecurringMonthlyExpenses;

// Ê≠•È©ü 4: Ë®àÁÆóÂàÜÊî§Âπ¥Ë≤ªÁ∏ΩÈ°ç
const amortizedAnnualFees = sumOfAnnualExpenses / 12;

// Ê≠•È©ü 5: Ë®àÁÆóÂØ¶ÈöõÂèØÁî®ÈáëÈ°ç
const availableBudget = totalIncome - autoSaving - monthlySubscriptions - amortizedAnnualFees;

// Ê≠•È©ü 6: Ë®àÁÆóÂ∑≤Ëä±Ë≤ªÈáëÈ°ç
const totalSpent = sumOfActualTransactions;

// Ê≠•È©ü 7: Ë®àÁÆóÂâ©È§òÈáëÈ°ç
const remainingBudget = availableBudget - totalSpent;
```

### Display Requirements

**Budget Dashboard Must Show**:

1. **Income Section**
   - üí∞ Êú¨ÊúàÊî∂ÂÖ•ÔºöNT$50,000
   - üìä Êî∂ÂÖ•ÊòéÁ¥∞ÔºöËñ™Ë≥á„ÄÅÁçéÈáë„ÄÅÂÖ∂‰ªñ

2. **Pre-Deduction Section** (Most Important)
   - üíæ Ëá™ÂãïÂÑ≤ËìÑÔºöNT$2,500 (5%)
   - üì± Âõ∫ÂÆöÊúàË≤ªÔºöNT$659
   - üìÖ ÂàÜÊî§Âπ¥Ë≤ªÔºöNT$1,664
   - ‚ûñ È†êÊâ£Á∏ΩÈ°çÔºöNT$4,823

3. **Available Budget** (Key Metric)
   - ‚úÖ **ÂØ¶ÈöõÂèØÁî®ÔºöNT$45,177**
   - ÈÄôÊòØ‰ΩøÁî®ËÄÖÊúÄÈóúÂøÉÁöÑÊï∏Â≠ó

4. **Spending Section**
   - üí≥ Â∑≤Ê∂àË≤ªÔºöNT$32,450
   - üìä ÂàÜÈ°ûÊòéÁ¥∞ÔºöÈ§êÈ£≤„ÄÅ‰∫§ÈÄö„ÄÅË≥ºÁâ©Á≠â
   - üéØ Ââ©È§òÈ°çÂ∫¶ÔºöNT$12,727

5. **Comparison**
   - üìà ËºÉ‰∏äÊúàÔºö+5% / -5%
   - üéØ È†êÁÆóÈÅîÊàêÁéáÔºö72%

---

## Historical Data Import

### Source: Google Sheets (2019-2025)

#### Data Structure

```
Columns:
- Date: ‰∫§ÊòìÊó•Êúü
- Card: ‰ø°Áî®Âç°ÂêçÁ®±
- Merchant: ÂïÜÂÆ∂ÂêçÁ®±
- Amount: ÈáëÈ°ç
- Category: ÂàÜÈ°û
- Note: ÂÇôË®ª
```

#### Import Strategy

**Phase 1: Recent Data (Priority)**

- Focus: 2024-2025 data
- Reason: Most relevant for current budget analysis
- Approach: Manual CSV upload via admin interface

**Phase 2: Complete History (Optional)**

- Timeframe: 2019-2023 data
- Approach: Bulk import script
- Purpose: Historical trend analysis

#### Data Validation

- ‚úÖ Check for duplicate transactions (by date + amount + merchant)
- ‚úÖ Validate card names against existing cards
- ‚úÖ Auto-create categories if missing
- ‚úÖ Flag large amounts for review (>NT$10,000)
- ‚úÖ Mark all imported data as "Manual Entry" source

#### Import UI Requirements

- CSV file upload
- Column mapping interface (map CSV columns to database fields)
- Preview before import (show first 10 rows)
- Progress indicator for large files
- Import summary report (success/error counts)
- Error log for failed rows

---

## Future Enhancements (Sprint 2+)

### Transaction Matching

**Purpose**: Match expected recurring expenses with actual transactions

**Workflow**:

1. System detects transaction similar to recurring expense
2. Suggest automatic matching
3. User confirms or adjusts
4. Link transaction to recurring expense
5. Remove from "unexpected spending" calculation

### Budget Forecasting

**Purpose**: Predict next month's budget based on patterns

**Features**:

- Seasonal spending patterns
- Recurring expense predictions
- Income stability analysis
- Savings goal tracking

### Multi-Currency Support

**Purpose**: Handle foreign transaction fees and exchange rates

**Requirements**:

- Store original currency and amount
- Track exchange rate at transaction time
- Calculate TWD equivalent
- Display both currencies

### Receipt Attachment

**Purpose**: Store receipt images for tax and warranty purposes

**Features**:

- Attach multiple images per transaction
- OCR receipt data
- Search by receipt content
- Export receipts for tax filing

### Apex Integration

**Purpose**: Export transaction data for statistical analysis

**Data Flow**:

```
Flourish (transactions) ‚Üí Apex (condition formulas) ‚Üí Charts/Insights
```

**Use Cases**:

- Financial health scoring
- Spending trend analysis
- Category optimization suggestions
- Savings goal progress tracking

---

## Key Differences from Original Plan

### Original Assumption

- ‚ùå Daily manual transaction entry
- ‚ùå Real-time categorization
- ‚ùå Simple income/expense tracking

### Actual Requirements

- ‚úÖ Monthly PDF statement batch processing
- ‚úÖ AI-powered transaction recognition
- ‚úÖ Pre-deduction budget calculation
- ‚úÖ Multi-card power user workflow
- ‚úÖ Historical data migration

### Architecture Impact

- **Database**: Statement-centric model (not transaction-centric)
- **UI Flow**: Upload ‚Üí Review ‚Üí Import (not Add Transaction form)
- **Budget Calculation**: Pre-deduction system (not simple sum)
- **Card Management**: Active/Inactive states (not single card assumption)

---

## Success Metrics

### Sprint 0.5 MVP Success

- ‚úÖ Upload PDF statement
- ‚úÖ Extract basic transaction data (date, amount, merchant)
- ‚úÖ Review and edit extracted data
- ‚úÖ Import transactions to database
- ‚úÖ Link transactions to statements
- ‚úÖ Manage multiple credit cards

### Sprint 2+ Success

- ‚úÖ Pre-deduction budget calculation
- ‚úÖ Recurring expense management
- ‚úÖ Auto-savings rules
- ‚úÖ Historical data imported
- ‚úÖ Transaction matching
- ‚úÖ Budget forecasting

### Long-term Success

- ‚è±Ô∏è **Time Savings**: 30 minutes/month ‚Üí 5 minutes/month
- üìä **Accuracy**: 95%+ transaction recognition
- üí∞ **Budget Clarity**: Always know actual available money
- üìà **Financial Insights**: Clear spending patterns and trends
- üéØ **Savings Goals**: Automatic enforcement of savings rules

---

## Related Documents

- [Database Design](../architecture/database-design.md)
- [Workflow Pivot Analysis](workflow-pivot-analysis.md)
- [Functional Requirements](functional-requirements.md)
- [Sprint 0.5 Requirements](../sprints/sprint-0.5-mvp/requirements.md)
