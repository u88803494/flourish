# ARCHITECTURE.md

**ç›®çš„**: Flourish å¹³å°çš„ç³»çµ±æ¶æ§‹æ–‡æª”

**æœ€å¾Œæ›´æ–°**: 2025-11-21
**ç‹€æ…‹**: ä½¿ç”¨ä¸­
**æ¶æ§‹ç‰ˆæœ¬**: 2.0 (Supabase-first)

---

## ğŸ—ï¸ æ¶æ§‹ç¸½è¦½

### é«˜éšæ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å®¢æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Flow (Next.js)        â”‚      Apex (Next.js)            â”‚
â”‚   è²¡å‹™è¿½è¹¤                  â”‚   æ•ˆèƒ½çµ±è¨ˆ                      â”‚
â”‚   Port: 3100               â”‚   Port: 3200                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Supabase å¹³å°                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Auth       â”‚  â”‚   Database   â”‚  â”‚   Storage    â”‚      â”‚
â”‚  â”‚   JWT/OAuth  â”‚  â”‚   PostgreSQL â”‚  â”‚   Files      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   REST API   â”‚  â”‚   Realtime   â”‚  â”‚   Functions  â”‚      â”‚
â”‚  â”‚   Auto-gen   â”‚  â”‚   WebSocket  â”‚  â”‚   Edge       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ RLS Policies
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PostgreSQL                              â”‚
â”‚                                                               â”‚
â”‚  Tables: users, cards, categories, statements,               â”‚
â”‚          transactions, recurring_expenses, saving_rules      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨ç½²æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Vercel (CDN)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  flow.vercel.app           â”‚  apex.vercel.app               â”‚
â”‚  (Production)              â”‚  (Production)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ API Calls
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Supabase Cloud (Global)                        â”‚
â”‚                                                               â”‚
â”‚  Project: fstcioczrehqtcbdzuij                               â”‚
â”‚  Region: Southeast Asia (Singapore)                          â”‚
â”‚  Tier: Free (50K MAU, 500MB DB, 1GB Storage)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ¶æ§‹æ±ºç­–è¨˜éŒ„ (ADRs)

### ADR 001: æ¶æ§‹ç°¡åŒ– (2025-11-07)

**ç‹€æ…‹**: å·²æ¥å—ä¸¦å¯¦æ–½
**èƒŒæ™¯**: è©•ä¼°å¾Œç«¯éƒ¨ç½²é¸é …ï¼ˆNestJS + Render vs Supabaseï¼‰

**æ±ºç­–**: æ¡ç”¨ Supabase-first æ¶æ§‹ï¼Œç§»é™¤ NestJS å¾Œç«¯

**ç†ç”±**:

- **æˆæœ¬**: $0/æœˆï¼ˆSupabase Freeï¼‰vs $7+/æœˆï¼ˆNestJS + Renderï¼‰
- **ç¶­è­·**: æ¸›å°‘ 70% åŸºç¤è¨­æ–½é–‹éŠ·
- **é–‹ç™¼é€Ÿåº¦**: å¿« 60%ï¼ˆè‡ªå‹•ç”Ÿæˆ API vs æ‰‹å‹•ç«¯é»ï¼‰
- **åŠŸèƒ½å¥‘åˆ**: CRUD + çµ±è¨ˆèˆ‡ Supabase èƒ½åŠ›å®Œç¾å°é½Š

**å¾Œæœ**:

- âœ… ç„¡éœ€ç¶­è­·å¾Œç«¯ä¼ºæœå™¨
- âœ… ç°¡åŒ–éƒ¨ç½²ï¼ˆåƒ… Vercelï¼‰
- âœ… å…§å»º Authã€Realtimeã€Storage
- âš ï¸ è¤‡é›œæ¥­å‹™é‚è¼¯éœ€è¦ Edge Functions
- âš ï¸ ä¾›æ‡‰å•†é–å®šæ–¼ Supabaseï¼ˆç·©è§£ï¼šPostgreSQL æ˜¯æ¨™æº–ï¼‰

**å¯¦æ–½**: Sprint 9ï¼ˆ4 å€‹ä»»å‹™ï¼‰
**æ–‡æª”**: `docs/decisions/001-architecture-simplification.md`

---

## ğŸ“¦ å…ƒä»¶æ¶æ§‹

### å‰ç«¯æ‡‰ç”¨ç¨‹å¼

#### Flow Appï¼ˆè²¡å‹™è¿½è¹¤ï¼‰

**æŠ€è¡“å †ç–Š**:

- æ¡†æ¶: Next.js 15 (App Router)
- èªè¨€: TypeScript 5 (strict mode)
- æ¨£å¼: Tailwind CSS
- ç‹€æ…‹: React Context + Hooks
- è³‡æ–™ç²å–: Supabase Client (@repo/supabase-client)

**æ ¸å¿ƒåŠŸèƒ½**:

- äº¤æ˜“ç®¡ç†ï¼ˆCRUDï¼‰
- åˆ†é¡çµ„ç¹”
- å¸³å–®åŒ¯å…¥
- å®šæœŸè²»ç”¨è¿½è¹¤
- å„²è“„è¦å‰‡è‡ªå‹•åŒ–

#### Apex Appï¼ˆæ•ˆèƒ½çµ±è¨ˆï¼‰

**æŠ€è¡“å †ç–Š**:

- æ¡†æ¶: Next.js 15 (App Router)
- èªè¨€: TypeScript 5 (strict mode)
- æ¨£å¼: Tailwind CSS
- åœ–è¡¨: å¾…å®šï¼ˆPhase 1ï¼‰
- è³‡æ–™ç²å–: Supabase Client (@repo/supabase-client)

**æ ¸å¿ƒåŠŸèƒ½**ï¼ˆè¦åŠƒä¸­ï¼‰:

- è²¡å‹™ KPI å„€è¡¨æ¿
- è¶¨å‹¢åˆ†æ
- ç›®æ¨™è¿½è¹¤
- æ•ˆèƒ½å ±å‘Š

### å…±äº«å¥—ä»¶

#### @repo/supabase-client

**ç›®çš„**: é›†ä¸­å¼ Supabase å®¢æˆ¶ç«¯é…ç½®èˆ‡å·¥å…·

**åŒ¯å‡º**:

- `supabase` - é…ç½®å¥½çš„ Supabase å®¢æˆ¶ç«¯å¯¦ä¾‹
- `useAuth()` - èªè­‰ hook
- `useUser()` - ç•¶å‰ä½¿ç”¨è€…è³‡æ–™ hook
- `useTransactions()` - äº¤æ˜“è³‡æ–™ hook
- Typesï¼ˆå¾è³‡æ–™åº« schema è‡ªå‹•ç”Ÿæˆï¼‰

**ä½¿ç”¨ç¯„ä¾‹**:

```typescript
import { supabase, useAuth } from '@repo/supabase-client';

function LoginPage() {
  const { signIn, signOut, user } = useAuth();
  // ...
}
```

#### @repo/database

**ç›®çš„**: è³‡æ–™åº« schema åƒè€ƒï¼ˆPrismaï¼‰

**ç‹€æ…‹**: åƒ…åƒè€ƒç”¨ï¼ˆä¸ç”¨æ–¼é·ç§»ï¼‰

**å…§å®¹**:

- `prisma/schema.prisma` - è³‡æ–™åº« schema å®šç¾©
- è¡¨é—œä¿‚æ–‡æª”
- è¨è«–ç”¨çš„é¡å‹åƒè€ƒ

**æ³¨æ„**: å¯¦éš›é·ç§»ä½¿ç”¨ Supabase SQL æª”æ¡ˆ

#### @repo/ui

**ç›®çš„**: å…±äº« React å…ƒä»¶

**å…ƒä»¶**:

- Buttonã€Inputã€Selectï¼ˆè¡¨å–®å…ƒç´ ï¼‰
- Cardã€Modalã€Dropdownï¼ˆå®¹å™¨ï¼‰
- Tableã€Listï¼ˆè³‡æ–™é¡¯ç¤ºï¼‰

**æ¨£å¼**: Tailwind CSS with consistent design tokens

---

## ğŸ—„ï¸ è³‡æ–™åº«æ¶æ§‹

### Schema è¨­è¨ˆ

**æ ¸å¿ƒè³‡æ–™è¡¨**:

```sql
-- ä½¿ç”¨è€…èªè­‰ï¼ˆç”± Supabase Auth ç®¡ç†ï¼‰
users
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ email
â”œâ”€â”€ created_at
â””â”€â”€ updated_at

-- æ”¯ä»˜å¡ç‰‡
cards
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ user_id (UUID, FK â†’ users.id)
â”œâ”€â”€ name
â”œâ”€â”€ last_four
â”œâ”€â”€ card_type
â””â”€â”€ is_active

-- äº¤æ˜“åˆ†é¡
categories
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ user_id (UUID, FK â†’ users.id)
â”œâ”€â”€ name
â”œâ”€â”€ type (income/expense)
â”œâ”€â”€ color
â””â”€â”€ icon

-- ä¿¡ç”¨å¡å¸³å–®
statements
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ card_id (UUID, FK â†’ cards.id)
â”œâ”€â”€ month, year
â”œâ”€â”€ due_date
â”œâ”€â”€ total_amount
â””â”€â”€ is_paid

-- è²¡å‹™äº¤æ˜“
transactions
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ user_id (UUID, FK â†’ users.id)
â”œâ”€â”€ category_id (UUID, FK â†’ categories.id)
â”œâ”€â”€ statement_id (UUID, FK â†’ statements.id, nullable)
â”œâ”€â”€ amount
â”œâ”€â”€ description
â”œâ”€â”€ transaction_date
â””â”€â”€ type (income/expense)

-- å®šæœŸè²»ç”¨
recurring_expenses
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ user_id (UUID, FK â†’ users.id)
â”œâ”€â”€ category_id (UUID, FK â†’ categories.id)
â”œâ”€â”€ amount
â”œâ”€â”€ frequency (daily/weekly/monthly/yearly)
â”œâ”€â”€ start_date, end_date (nullable)
â””â”€â”€ is_active

-- è‡ªå‹•å„²è“„è¦å‰‡
saving_rules
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ user_id (UUID, FK â†’ users.id)
â”œâ”€â”€ name
â”œâ”€â”€ rule_type (percentage/fixed/conditional)
â”œâ”€â”€ amount
â”œâ”€â”€ condition (JSON, nullable)
â””â”€â”€ is_active
```

### Row Level Security (RLS)

**ç­–ç•¥æ¨¡å¼**:

```sql
-- ä½¿ç”¨è€…åªèƒ½å­˜å–è‡ªå·±çš„è³‡æ–™
ALTER TABLE transactions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own transactions" ON transactions
  USING (auth.uid() = user_id);
```

**å¥—ç”¨è‡³æ‰€æœ‰ä½¿ç”¨è€…ç¯„åœè¡¨**:

- transactions
- categories
- cards
- statements
- recurring_expenses
- saving_rules

**å„ªé»**:

- è‡ªå‹•å¤šç§Ÿæˆ¶
- æŸ¥è©¢ä¸­ä¸éœ€è¦ WHERE user_id = ?
- åœ¨è³‡æ–™åº«å±¤ç´šå¼·åˆ¶åŸ·è¡Œå®‰å…¨æ€§

### ç´¢å¼•

**å¤–éµ**ï¼ˆè‡ªå‹•ï¼‰:

```sql
CREATE INDEX idx_transactions_user_id ON transactions(user_id);
CREATE INDEX idx_transactions_category_id ON transactions(category_id);
CREATE INDEX idx_transactions_statement_id ON transactions(statement_id);
```

**æŸ¥è©¢å„ªåŒ–**:

```sql
CREATE INDEX idx_transactions_date ON transactions(transaction_date DESC);
CREATE INDEX idx_transactions_type ON transactions(type);
```

---

## ğŸ” å®‰å…¨æ¶æ§‹

### èªè­‰æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç€è¦½å™¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. signIn(email, password)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Auth   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - é©—è­‰æ†‘è­‰       â”‚
â”‚ - ç”Ÿæˆ JWT      â”‚
â”‚ - è¨­å®š session  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 2. JWT Token
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®¢æˆ¶ç«¯å„²å­˜        â”‚
â”‚ (localStorage)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 3. è«‹æ±‚ä¸­åŒ…å«
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase REST API  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - é©—è­‰ JWT         â”‚
â”‚ - æå– user_id     â”‚
â”‚ - å¥—ç”¨ RLS         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è³‡æ–™å­˜å–æ§åˆ¶

**å±¤ç´š**:

1. **èªè­‰**ï¼ˆSupabase Authï¼‰ï¼šä½ æ˜¯èª°ï¼Ÿ
2. **æˆæ¬Š**ï¼ˆRLS ç­–ç•¥ï¼‰ï¼šä½ å¯ä»¥å­˜å–ä»€éº¼ï¼Ÿ
3. **é©—è­‰**ï¼ˆæ‡‰ç”¨ç¨‹å¼ï¼‰ï¼šé€™å€‹è³‡æ–™æœ‰æ•ˆå—ï¼Ÿ

**å®‰å…¨åŸå‰‡**:

- é›¶ä¿¡ä»»ï¼šé©—è­‰æ¯å€‹è«‹æ±‚
- æœ€å°æ¬Šé™ï¼šä½¿ç”¨è€…åªèƒ½å­˜å–è‡ªå·±çš„è³‡æ–™
- æ·±åº¦é˜²ç¦¦ï¼šå¤šå€‹å®‰å…¨å±¤ç´š
- åŠ å¯†ï¼šå‚³è¼¸ä½¿ç”¨ HTTPSï¼Œéœæ…‹åŠ å¯†

### ç’°å¢ƒè®Šæ•¸

**å…¬é–‹**ï¼ˆæš´éœ²çµ¦ç€è¦½å™¨ï¼‰:

```bash
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGc...
```

**ç§å¯†**ï¼ˆåƒ…ä¼ºæœå™¨ç«¯ï¼‰:

```bash
SUPABASE_SERVICE_ROLE_KEY=eyJhbGc...  # çµ•ä¸æš´éœ²çµ¦å‰ç«¯ï¼
```

**ç”¨é€”**:

- Anon keyï¼šå‰ç«¯å®‰å…¨ï¼Œå— RLS é™åˆ¶
- Service role keyï¼šç¹é RLSï¼Œåƒ…ç”¨æ–¼é·ç§»

---

## ğŸš€ éƒ¨ç½²æ¶æ§‹

### å‰ç«¯éƒ¨ç½²ï¼ˆVercelï¼‰

**è§¸ç™¼**: æ¨é€åˆ° `main` åˆ†æ”¯
**æµç¨‹**:

1. Git push â†’ Vercel åµæ¸¬è®Šæ›´
2. Vercel å»ºç½® Next.js apps
3. éƒ¨ç½²åˆ°å…¨çƒ CDN
4. æ›´æ–° DNS

**ç’°å¢ƒè®Šæ•¸**ï¼ˆVercel Dashboardï¼‰:

```bash
NEXT_PUBLIC_SUPABASE_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY
```

**ç¶²åŸŸ**:

- Flow: `https://flourish-flow.vercel.app`
- Apex: `https://flourish-apex.vercel.app`

### è³‡æ–™åº«éƒ¨ç½²ï¼ˆSupabaseï¼‰

**é·ç§»å·¥ä½œæµç¨‹**:

```bash
# æœ¬åœ°é–‹ç™¼
npx supabase migration new feature_name
# ç·¨è¼¯ supabase/migrations/ ä¸­çš„ SQL æª”æ¡ˆ

# æœ¬åœ°æ¸¬è©¦
npx supabase db reset

# éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
npx supabase db push
```

**å›æ»¾ç­–ç•¥**:

- å‰µå»ºåå‘é·ç§»
- Supabase ä¸æ”¯æ´è‡ªå‹•å›æ»¾
- ä¿ç•™å‚™ä»½ï¼ˆè‡ªå‹•æ¯æ—¥å‚™ä»½ï¼‰

---

## ğŸ“Š æ•ˆèƒ½æ¶æ§‹

### å¿«å–ç­–ç•¥

**CDN å¿«å–**ï¼ˆVercelï¼‰:

- éœæ…‹è³‡æºï¼šæ°¸ä¹…å¿«å–
- SSR é é¢ï¼šå¸¶é‡æ–°é©—è­‰çš„å¿«å–
- API è·¯ç”±ï¼šä¸å¿«å–ï¼ˆä½¿ç”¨è€…ç‰¹å®šï¼‰

**å®¢æˆ¶ç«¯å¿«å–**:

- Supabase Clientï¼šè¨˜æ†¶é«”å…§å¿«å–
- React Queryï¼ˆæœªä¾†ï¼‰ï¼šä¼ºæœå™¨ç‹€æ…‹ç®¡ç†

### è³‡æ–™åº«å„ªåŒ–

**ç´¢å¼•**:

- æ‰€æœ‰å¤–éµå·²ç´¢å¼•
- æ—¥æœŸæ¬„ä½ç”¨æ–¼æ’åº
- é »ç¹éæ¿¾çš„æ¬„ä½

**æŸ¥è©¢å„ªåŒ–**:

- RLS ç­–ç•¥ä½¿ç”¨å·²ç´¢å¼•æ¬„ä½
- é™åˆ¶çµæœé›†
- å¤§å‹è³‡æ–™é›†åˆ†é 

### Bundle å¤§å°

**ç›®æ¨™**: < 200KB åˆå§‹ JS bundle

**å„ªåŒ–**:

- Tree-shakingï¼ˆè‡ªå‹•ï¼‰
- ç¨‹å¼ç¢¼åˆ†å‰²ï¼ˆåŸºæ–¼è·¯ç”±ï¼‰
- é‡å‹å…ƒä»¶çš„å‹•æ…‹å°å…¥
- åœ–è¡¨çš„å»¶é²è¼‰å…¥ï¼ˆæœªä¾†ï¼‰

---

## ğŸ§© æ•´åˆé»

### å¤–éƒ¨æœå‹™

**Supabase**ï¼ˆä¸»è¦ï¼‰:

- è³‡æ–™åº«ï¼ˆPostgreSQLï¼‰
- èªè­‰ï¼ˆJWTï¼‰
- å„²å­˜ï¼ˆæª”æ¡ˆä¸Šå‚³ï¼‰
- Realtimeï¼ˆWebSocketï¼‰
- Edge Functionsï¼ˆæœªä¾†ï¼‰

**Vercel**ï¼ˆéƒ¨ç½²ï¼‰:

- CDN è¨—ç®¡
- Serverless functionsï¼ˆå¦‚éœ€è¦ï¼‰
- åˆ†æ
- ç’°å¢ƒç®¡ç†

**æœªä¾†æ•´åˆ**ï¼ˆPhase 2+ï¼‰:

- æ”¯ä»˜é–˜é“ï¼ˆStripeï¼‰
- é›»å­éƒµä»¶æœå‹™ï¼ˆSendGrid/Postmarkï¼‰
- åˆ†æï¼ˆPostHog/Mixpanelï¼‰
- éŒ¯èª¤è¿½è¹¤ï¼ˆSentryï¼‰

---

## ğŸ”® æœªä¾†æ¶æ§‹è€ƒé‡

### å¯æ“´å±•æ€§

**ç›®å‰é™åˆ¶**ï¼ˆSupabase Free Tierï¼‰:

- 50,000 MAUï¼ˆæ¯æœˆæ´»èºä½¿ç”¨è€…ï¼‰
- 500 MB è³‡æ–™åº«å„²å­˜
- 1 GB æª”æ¡ˆå„²å­˜
- 2 GB é »å¯¬

**æ“´å±•è·¯å¾‘**:

1. **Phase 1**ï¼ˆ0-50K ä½¿ç”¨è€…ï¼‰ï¼šå…è²»å±¤ç´š
2. **Phase 2**ï¼ˆ50K-500K ä½¿ç”¨è€…ï¼‰ï¼šSupabase Proï¼ˆ$25/æœˆï¼‰
3. **Phase 3**ï¼ˆ500K+ ä½¿ç”¨è€…ï¼‰ï¼šTeam/Enterprise æ–¹æ¡ˆ

**æ°´å¹³æ“´å±•**:

- Supabase è™•ç†è³‡æ–™åº«æ“´å±•
- Vercel è™•ç†å‰ç«¯ CDN æ“´å±•
- Edge Functions ç”¨æ–¼é‹ç®—æ“´å±•

### é·ç§»è·¯å¾‘

**å¦‚æœ Supabase è®Šå¾—å—é™**:

1. åŒ¯å‡º PostgreSQL è³‡æ–™åº«ï¼ˆæ¨™æº–æ ¼å¼ï¼‰
2. é·ç§»åˆ°è¨—ç®¡ PostgreSQLï¼ˆAWS RDS ç­‰ï¼‰
3. ä½¿ç”¨ NextAuth.js æˆ–é¡ä¼¼å·¥å…·é‡æ–°å¯¦ä½œ Auth
4. ç‚ºè¤‡é›œæ¥­å‹™é‚è¼¯æ–°å¢ NestJSï¼ˆç¨‹å¼ç¢¼å·²å­˜æª”ï¼‰

**æˆæœ¬**: ~1 é€±å·¥ä½œé‡ï¼ˆæ¶æ§‹å·²ä¿ç•™ï¼‰

---

## ğŸ“š ç›¸é—œæ–‡æª”

**æ¶æ§‹æ±ºç­–**:

- `docs/decisions/001-architecture-simplification.md`

**å¯¦ä½œæŒ‡å—**:

- `docs/guides/database-migrations.md`
- `docs/guides/development.md`

**éƒ¨ç½²**:

- `docs/deployment/README.md`
- `docs/deployment/git-workflow.md`

---

**ç¶­è­·è€…**: Flourish Team
**æ¶æ§‹ç‰ˆæœ¬**: 2.0 (Supabase-first)
**ä¸Šæ¬¡ä¸»è¦æ›´æ–°**: Sprint 9 (2025-11-21)
**ä¸‹æ¬¡å¯©æŸ¥**: Sprint 1ï¼ˆèªè­‰å¯¦ä½œï¼‰
